(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["webgl~253ae210"],{"10a2":function(e,t,i){"use strict";i.d(t,"a",(function(){return T})),i.d(t,"b",(function(){return M})),i.d(t,"c",(function(){return ot})),i.d(t,"d",(function(){return at})),i.d(t,"e",(function(){return w})),i.d(t,"f",(function(){return h})),i.d(t,"g",(function(){return Ti}));var n=i("257e"),o=(i("45eb"),i("7e84"),i("53ca")),a=i("262e"),r=i("2caf"),s=i("d4ec"),l=i("bee2"),u=(i("d3b7"),i("25f0"),i("caad"),i("2532"),i("a434"),i("fb6a"),i("a9e3"),i("b0c0"),i("99af"),i("cfc3"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("8b09"),i("b64b"),i("1276"),i("ac1f"),i("ddb0"),i("6c57"),function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0,0,0,0,0,0];Object(s["a"])(this,e),this.elements=t}return Object(l["a"])(e,[{key:"identity",value:function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}},{key:"setZero",value:function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}},{key:"setTrace",value:function(e){var t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}},{key:"getTrace",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new h,t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}},{key:"vmult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h,i=this.elements,n=e.x,o=e.y,a=e.z;return t.x=i[0]*n+i[1]*o+i[2]*a,t.y=i[3]*n+i[4]*o+i[5]*a,t.z=i[6]*n+i[7]*o+i[8]*a,t}},{key:"smult",value:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t]*=e}},{key:"mmult",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.elements,o=t.elements,a=i.elements,r=n[0],s=n[1],l=n[2],u=n[3],h=n[4],c=n[5],v=n[6],d=n[7],p=n[8],y=o[0],f=o[1],m=o[2],b=o[3],w=o[4],g=o[5],x=o[6],E=o[7],k=o[8];return a[0]=r*y+s*b+l*x,a[1]=r*f+s*w+l*E,a[2]=r*m+s*g+l*k,a[3]=u*y+h*b+c*x,a[4]=u*f+h*w+c*E,a[5]=u*m+h*g+c*k,a[6]=v*y+d*b+p*x,a[7]=v*f+d*w+p*E,a[8]=v*m+d*g+p*k,i}},{key:"scale",value:function(t){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.elements,o=i.elements,a=0;3!==a;a++)o[3*a+0]=t.x*n[3*a+0],o[3*a+1]=t.y*n[3*a+1],o[3*a+2]=t.z*n[3*a+2];return i}},{key:"solve",value:function(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h,o=3,a=4,r=[];for(t=0;t<o*a;t++)r.push(0);for(t=0;t<3;t++)for(i=0;i<3;i++)r[t+a*i]=this.elements[t+3*i];r[3]=e.x,r[7]=e.y,r[11]=e.z;var s,l,u=3,c=u,v=4;do{if(t=c-u,0===r[t+a*t])for(i=t+1;i<c;i++)if(0!==r[t+a*i]){s=v;do{l=v-s,r[l+a*t]+=r[l+a*i]}while(--s);break}if(0!==r[t+a*t])for(i=t+1;i<c;i++){var d=r[t+a*i]/r[t+a*t];s=v;do{l=v-s,r[l+a*i]=l<=t?0:r[l+a*i]-r[l+a*t]*d}while(--s)}}while(--u);if(n.z=r[2*a+3]/r[2*a+2],n.y=(r[1*a+3]-r[1*a+2]*n.z)/r[1*a+1],n.x=(r[0*a+3]-r[0*a+2]*n.z-r[0*a+1]*n.y)/r[0*a+0],isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||n.x===1/0||n.y===1/0||n.z===1/0)throw"Could not solve equation! Got x=["+n.toString()+"], b=["+e.toString()+"], A=["+this.toString()+"]";return n}},{key:"e",value:function(e,t,i){if(void 0===i)return this.elements[t+3*e];this.elements[t+3*e]=i}},{key:"copy",value:function(e){for(var t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}},{key:"toString",value:function(){for(var e="",t=",",i=0;i<9;i++)e+=this.elements[i]+t;return e}},{key:"reverse",value:function(){var t,i,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,o=3,a=6,r=[];for(t=0;t<o*a;t++)r.push(0);for(t=0;t<3;t++)for(i=0;i<3;i++)r[t+a*i]=this.elements[t+3*i];r[3]=1,r[9]=0,r[15]=0,r[4]=0,r[10]=1,r[16]=0,r[5]=0,r[11]=0,r[17]=1;var s,l,u=3,h=u,c=a;do{if(t=h-u,0===r[t+a*t])for(i=t+1;i<h;i++)if(0!==r[t+a*i]){s=c;do{l=c-s,r[l+a*t]+=r[l+a*i]}while(--s);break}if(0!==r[t+a*t])for(i=t+1;i<h;i++){var v=r[t+a*i]/r[t+a*t];s=c;do{l=c-s,r[l+a*i]=l<=t?0:r[l+a*i]-r[l+a*t]*v}while(--s)}}while(--u);t=2;do{i=t-1;do{var d=r[t+a*i]/r[t+a*t];s=a;do{l=a-s,r[l+a*i]=r[l+a*i]-r[l+a*t]*d}while(--s)}while(i--)}while(--t);t=2;do{var p=1/r[t+a*t];s=a;do{l=a-s,r[l+a*t]=r[l+a*t]*p}while(--s)}while(t--);t=2;do{i=2;do{if(l=r[o+i+a*t],isNaN(l)||l===1/0)throw"Could not reverse! A=["+this.toString()+"]";n.e(t,i,l)}while(i--)}while(t--);return n}},{key:"setRotationFromQuaternion",value:function(e){var t=e.x,i=e.y,n=e.z,o=e.w,a=t+t,r=i+i,s=n+n,l=t*a,u=t*r,h=t*s,c=i*r,v=i*s,d=n*s,p=o*a,y=o*r,f=o*s,m=this.elements;return m[0]=1-(c+d),m[1]=u-f,m[2]=h+y,m[3]=u+f,m[4]=1-(l+d),m[5]=v-p,m[6]=h-y,m[7]=v+p,m[8]=1-(l+c),this}},{key:"transpose",value:function(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,n=this.elements,o=i.elements;return o[0]=n[0],o[4]=n[4],o[8]=n[8],t=n[1],o[1]=n[3],o[3]=t,t=n[2],o[2]=n[6],o[6]=t,t=n[5],o[5]=n[7],o[7]=t,i}}]),e}()),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(s["a"])(this,e),this.x=t,this.y=i,this.z=n}return Object(l["a"])(e,[{key:"cross",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=t.x,o=t.y,a=t.z,r=this.x,s=this.y,l=this.z;return i.x=s*a-l*o,i.y=l*n-r*a,i.z=r*o-s*n,i}},{key:"set",value:function(e,t,i){return this.x=e,this.y=t,this.z=i,this}},{key:"setZero",value:function(){this.x=this.y=this.z=0}},{key:"vadd",value:function(t,i){if(!i)return new e(this.x+t.x,this.y+t.y,this.z+t.z);i.x=t.x+this.x,i.y=t.y+this.y,i.z=t.z+this.z}},{key:"vsub",value:function(t,i){if(!i)return new e(this.x-t.x,this.y-t.y,this.z-t.z);i.x=this.x-t.x,i.y=this.y-t.y,i.z=this.z-t.z}},{key:"crossmat",value:function(){return new u([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}},{key:"normalize",value:function(){var e=this.x,t=this.y,i=this.z,n=Math.sqrt(e*e+t*t+i*i);if(n>0){var o=1/n;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return n}},{key:"unit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,i=this.x,n=this.y,o=this.z,a=Math.sqrt(i*i+n*n+o*o);return a>0?(a=1/a,t.x=i*a,t.y=n*a,t.z=o*a):(t.x=1,t.y=0,t.z=0),t}},{key:"length",value:function(){var e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}},{key:"lengthSquared",value:function(){return this.dot(this)}},{key:"distanceTo",value:function(e){var t=this.x,i=this.y,n=this.z,o=e.x,a=e.y,r=e.z;return Math.sqrt((o-t)*(o-t)+(a-i)*(a-i)+(r-n)*(r-n))}},{key:"distanceSquared",value:function(e){var t=this.x,i=this.y,n=this.z,o=e.x,a=e.y,r=e.z;return(o-t)*(o-t)+(a-i)*(a-i)+(r-n)*(r-n)}},{key:"scale",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.x,o=this.y,a=this.z;return i.x=t*n,i.y=t*o,i.z=t*a,i}},{key:"vmul",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;return i.x=t.x*this.x,i.y=t.y*this.y,i.z=t.z*this.z,i}},{key:"addScaledVector",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e;return n.x=this.x+t*i.x,n.y=this.y+t*i.y,n.z=this.z+t*i.z,n}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"isZero",value:function(){return 0===this.x&&0===this.y&&0===this.z}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t}},{key:"tangents",value:function(e,t){var i=this.length();if(i>0){var n=c,o=1/i;n.set(this.x*o,this.y*o,this.z*o);var a=v;Math.abs(n.x)<.9?(a.set(1,0,0),n.cross(a,e)):(a.set(0,1,0),n.cross(a,e)),n.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}},{key:"toString",value:function(){return this.x+","+this.y+","+this.z}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"lerp",value:function(e,t,i){var n=this.x,o=this.y,a=this.z;i.x=n+(e.x-n)*t,i.y=o+(e.y-o)*t,i.z=a+(e.z-a)*t}},{key:"almostEquals",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}},{key:"almostZero",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e-6;return!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}},{key:"isAntiparallelTo",value:function(e,t){return this.negate(d),d.almostEquals(e,t)}},{key:"clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();h.ZERO=new h(0,0,0),h.UNIT_X=new h(1,0,0),h.UNIT_Y=new h(0,1,0),h.UNIT_Z=new h(0,0,1);var c=new h,v=new h,d=new h,p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s["a"])(this,e),this.lowerBound=new h,this.upperBound=new h,t.lowerBound&&this.lowerBound.copy(t.lowerBound),t.upperBound&&this.upperBound.copy(t.upperBound)}return Object(l["a"])(e,[{key:"setFromPoints",value:function(e,t,i,n){var o=this.lowerBound,a=this.upperBound,r=i;o.copy(e[0]),r&&r.vmult(o,o),a.copy(o);for(var s=1;s<e.length;s++){var l=e[s];r&&(r.vmult(l,y),l=y),l.x>a.x&&(a.x=l.x),l.x<o.x&&(o.x=l.x),l.y>a.y&&(a.y=l.y),l.y<o.y&&(o.y=l.y),l.z>a.z&&(a.z=l.z),l.z<o.z&&(o.z=l.z)}return t&&(t.vadd(o,o),t.vadd(a,a)),n&&(o.x-=n,o.y-=n,o.z-=n,a.x+=n,a.y+=n,a.z+=n),this}},{key:"copy",value:function(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"extend",value:function(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}},{key:"overlaps",value:function(e){var t=this.lowerBound,i=this.upperBound,n=e.lowerBound,o=e.upperBound,a=n.x<=i.x&&i.x<=o.x||t.x<=o.x&&o.x<=i.x,r=n.y<=i.y&&i.y<=o.y||t.y<=o.y&&o.y<=i.y,s=n.z<=i.z&&i.z<=o.z||t.z<=o.z&&o.z<=i.z;return a&&r&&s}},{key:"volume",value:function(){var e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}},{key:"contains",value:function(e){var t=this.lowerBound,i=this.upperBound,n=e.lowerBound,o=e.upperBound;return t.x<=n.x&&i.x>=o.x&&t.y<=n.y&&i.y>=o.y&&t.z<=n.z&&i.z>=o.z}},{key:"getCorners",value:function(e,t,i,n,o,a,r,s){var l=this.lowerBound,u=this.upperBound;e.copy(l),t.set(u.x,l.y,l.z),i.set(u.x,u.y,l.z),n.set(l.x,u.y,u.z),o.set(u.x,l.y,u.z),a.set(l.x,u.y,l.z),r.set(l.x,l.y,u.z),s.copy(u)}},{key:"toLocalFrame",value:function(e,t){var i=f,n=i[0],o=i[1],a=i[2],r=i[3],s=i[4],l=i[5],u=i[6],h=i[7];this.getCorners(n,o,a,r,s,l,u,h);for(var c=0;8!==c;c++){var v=i[c];e.pointToLocal(v,v)}return t.setFromPoints(i)}},{key:"toWorldFrame",value:function(e,t){var i=f,n=i[0],o=i[1],a=i[2],r=i[3],s=i[4],l=i[5],u=i[6],h=i[7];this.getCorners(n,o,a,r,s,l,u,h);for(var c=0;8!==c;c++){var v=i[c];e.pointToWorld(v,v)}return t.setFromPoints(i)}},{key:"overlapsRay",value:function(e){var t=e.direction,i=e.from,n=1/t.x,o=1/t.y,a=1/t.z,r=(this.lowerBound.x-i.x)*n,s=(this.upperBound.x-i.x)*n,l=(this.lowerBound.y-i.y)*o,u=(this.upperBound.y-i.y)*o,h=(this.lowerBound.z-i.z)*a,c=(this.upperBound.z-i.z)*a,v=Math.max(Math.max(Math.min(r,s),Math.min(l,u)),Math.min(h,c)),d=Math.min(Math.min(Math.max(r,s),Math.max(l,u)),Math.max(h,c));return!(d<0)&&!(v>d)}}]),e}(),y=new h,f=[new h,new h,new h,new h,new h,new h,new h,new h],m=function(){function e(){Object(s["a"])(this,e),this.matrix=[]}return Object(l["a"])(e,[{key:"get",value:function(e,t){var i=e.index,n=t.index;if(n>i){var o=n;n=i,i=o}return this.matrix[(i*(i+1)>>1)+n-1]}},{key:"set",value:function(e,t,i){var n=e.index,o=t.index;if(o>n){var a=o;o=n,n=a}this.matrix[(n*(n+1)>>1)+o-1]=i?1:0}},{key:"reset",value:function(){for(var e=0,t=this.matrix.length;e!==t;e++)this.matrix[e]=0}},{key:"setNumObjects",value:function(e){this.matrix.length=e*(e-1)>>1}}]),e}(),b=function(){function e(){Object(s["a"])(this,e)}return Object(l["a"])(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[e]&&(i[e]=[]),i[e].includes(t)||i[e].push(t),this}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return!(void 0===i[e]||!i[e].includes(t))}},{key:"hasAnyEventListener",value:function(e){if(void 0===this._listeners)return!1;var t=this._listeners;return void 0!==t[e]}},{key:"removeEventListener",value:function(e,t){if(void 0===this._listeners)return this;var i=this._listeners;if(void 0===i[e])return this;var n=i[e].indexOf(t);return-1!==n&&i[e].splice(n,1),this}},{key:"dispatchEvent",value:function(e){if(void 0===this._listeners)return this;var t=this._listeners,i=t[e.type];if(void 0!==i){e.target=this;for(var n=0,o=i.length;n<o;n++)i[n].call(this,e)}return this}}]),e}(),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(s["a"])(this,e),this.x=t,this.y=i,this.z=n,this.w=o}return Object(l["a"])(e,[{key:"set",value:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}},{key:"toString",value:function(){return this.x+","+this.y+","+this.z+","+this.w}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"setFromAxisAngle",value:function(e,t){var i=Math.sin(.5*t);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(.5*t),this}},{key:"toAxisAngle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new h;this.normalize();var t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}},{key:"setFromVectors",value:function(e,t){if(e.isAntiparallelTo(t)){var i=g,n=x;e.tangents(i,n),this.setFromAxisAngle(i,Math.PI)}else{var o=e.cross(t);this.x=o.x,this.y=o.y,this.z=o.z,this.w=Math.sqrt(Math.pow(e.length(),2)*Math.pow(t.length(),2))+e.dot(t),this.normalize()}return this}},{key:"mult",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e,n=this.x,o=this.y,a=this.z,r=this.w,s=t.x,l=t.y,u=t.z,h=t.w;return i.x=n*h+r*s+o*u-a*l,i.y=o*h+r*l+a*s-n*u,i.z=a*h+r*u+n*l-o*s,i.w=r*h-n*s-o*l-a*u,i}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e,i=this.x,n=this.y,o=this.z,a=this.w;this.conjugate(t);var r=1/(i*i+n*n+o*o+a*a);return t.x*=r,t.y*=r,t.z*=r,t.w*=r,t}},{key:"conjugate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e;return t.x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t}},{key:"normalize",value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"normalizeFast",value:function(){var e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===e?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}},{key:"vmult",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h,i=e.x,n=e.y,o=e.z,a=this.x,r=this.y,s=this.z,l=this.w,u=l*i+r*o-s*n,c=l*n+s*i-a*o,v=l*o+a*n-r*i,d=-a*i-r*n-s*o;return t.x=u*l+d*-a+c*-s-v*-r,t.y=c*l+d*-r+v*-a-u*-s,t.z=v*l+d*-s+u*-r-c*-a,t}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}},{key:"toEuler",value:function(e){var t,i,n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YZX",a=this.x,r=this.y,s=this.z,l=this.w;switch(o){case"YZX":var u=a*r+s*l;if(u>.499&&(t=2*Math.atan2(a,l),i=Math.PI/2,n=0),u<-.499&&(t=-2*Math.atan2(a,l),i=-Math.PI/2,n=0),void 0===t){var h=a*a,c=r*r,v=s*s;t=Math.atan2(2*r*l-2*a*s,1-2*c-2*v),i=Math.asin(2*u),n=Math.atan2(2*a*l-2*r*s,1-2*h-2*v)}break;default:throw new Error("Euler order "+o+" not supported yet.")}e.y=t,e.z=i,e.x=n}},{key:"setFromEuler",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",o=Math.cos(e/2),a=Math.cos(t/2),r=Math.cos(i/2),s=Math.sin(e/2),l=Math.sin(t/2),u=Math.sin(i/2);return"XYZ"===n?(this.x=s*a*r+o*l*u,this.y=o*l*r-s*a*u,this.z=o*a*u+s*l*r,this.w=o*a*r-s*l*u):"YXZ"===n?(this.x=s*a*r+o*l*u,this.y=o*l*r-s*a*u,this.z=o*a*u-s*l*r,this.w=o*a*r+s*l*u):"ZXY"===n?(this.x=s*a*r-o*l*u,this.y=o*l*r+s*a*u,this.z=o*a*u+s*l*r,this.w=o*a*r-s*l*u):"ZYX"===n?(this.x=s*a*r-o*l*u,this.y=o*l*r+s*a*u,this.z=o*a*u-s*l*r,this.w=o*a*r+s*l*u):"YZX"===n?(this.x=s*a*r+o*l*u,this.y=o*l*r+s*a*u,this.z=o*a*u-s*l*r,this.w=o*a*r-s*l*u):"XZY"===n&&(this.x=s*a*r-o*l*u,this.y=o*l*r-s*a*u,this.z=o*a*u+s*l*r,this.w=o*a*r+s*l*u),this}},{key:"clone",value:function(){return new e(this.x,this.y,this.z,this.w)}},{key:"slerp",value:function(t,i){var n,o,a,r,s,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new e,u=this.x,h=this.y,c=this.z,v=this.w,d=t.x,p=t.y,y=t.z,f=t.w;return o=u*d+h*p+c*y+v*f,o<0&&(o=-o,d=-d,p=-p,y=-y,f=-f),1-o>1e-6?(n=Math.acos(o),a=Math.sin(n),r=Math.sin((1-i)*n)/a,s=Math.sin(i*n)/a):(r=1-i,s=i),l.x=r*u+s*d,l.y=r*h+s*p,l.z=r*c+s*y,l.w=r*v+s*f,l}},{key:"integrate",value:function(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new e,a=t.x*n.x,r=t.y*n.y,s=t.z*n.z,l=this.x,u=this.y,h=this.z,c=this.w,v=.5*i;return o.x+=v*(a*c+r*h-s*u),o.y+=v*(r*c+s*l-a*h),o.z+=v*(s*c+a*u-r*l),o.w+=v*(-a*l-r*u-s*h),o}}]),e}(),g=new h,x=new h,E={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256},k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s["a"])(this,e),this.id=e.idCounter++,this.type=t.type||0,this.boundingSphereRadius=0,this.collisionResponse=!t.collisionResponse||t.collisionResponse,this.collisionFilterGroup=void 0!==t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask=void 0!==t.collisionFilterMask?t.collisionFilterMask:-1,this.material=t.material?t.material:null,this.body=null}return Object(l["a"])(e,[{key:"updateBoundingSphereRadius",value:function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type}},{key:"volume",value:function(){throw"volume() not implemented for shape type "+this.type}},{key:"calculateLocalInertia",value:function(e,t){throw"calculateLocalInertia() not implemented for shape type "+this.type}},{key:"calculateWorldAABB",value:function(e,t,i,n){throw"calculateWorldAABB() not implemented for shape type "+this.type}}]),e}();k.idCounter=0,k.types=E;var z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s["a"])(this,e),this.position=new h,this.quaternion=new w,t.position&&this.position.copy(t.position),t.quaternion&&this.quaternion.copy(t.quaternion)}return Object(l["a"])(e,[{key:"pointToLocal",value:function(t,i){return e.pointToLocalFrame(this.position,this.quaternion,t,i)}},{key:"pointToWorld",value:function(t,i){return e.pointToWorldFrame(this.position,this.quaternion,t,i)}},{key:"vectorToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;return this.quaternion.vmult(e,t),t}}],[{key:"pointToLocalFrame",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h;return i.vsub(e,n),t.conjugate(S),S.vmult(n,n),n}},{key:"pointToWorldFrame",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h;return t.vmult(i,n),n.vadd(e,n),n}},{key:"vectorToWorldFrame",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new h;return e.vmult(t,i),i}},{key:"vectorToLocalFrame",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new h;return t.w*=-1,t.vmult(i,n),t.w*=-1,n}}]),e}(),S=new w,A=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s["a"])(this,i);var o=n.vertices,a=void 0===o?[]:o,r=n.faces,l=void 0===r?[]:r,u=n.normals,h=void 0===u?[]:u,c=n.axes,v=n.boundingSphereRadius;return e=t.call(this,{type:k.types.CONVEXPOLYHEDRON}),e.vertices=a,e.faces=l,e.faceNormals=h,0===e.faceNormals.length&&e.computeNormals(),v?e.boundingSphereRadius=v:e.updateBoundingSphereRadius(),e.worldVertices=[],e.worldVerticesNeedsUpdate=!0,e.worldFaceNormals=[],e.worldFaceNormalsNeedsUpdate=!0,e.uniqueAxes=c?c.slice():null,e.uniqueEdges=[],e.computeEdges(),e}return Object(l["a"])(i,[{key:"computeEdges",value:function(){var e=this.faces,t=this.vertices,i=this.uniqueEdges;i.length=0;for(var n=new h,o=0;o!==e.length;o++)for(var a=e[o],r=a.length,s=0;s!==r;s++){var l=(s+1)%r;t[a[s]].vsub(t[a[l]],n),n.normalize();for(var u=!1,c=0;c!==i.length;c++)if(i[c].almostEquals(n)||i[c].almostEquals(n)){u=!0;break}u||i.push(n.clone())}}},{key:"computeNormals",value:function(){this.faceNormals.length=this.faces.length;for(var e=0;e<this.faces.length;e++){for(var t=0;t<this.faces[e].length;t++)if(!this.vertices[this.faces[e][t]])throw new Error("Vertex "+this.faces[e][t]+" not found!");var i=this.faceNormals[e]||new h;this.getFaceNormal(e,i),i.negate(i),this.faceNormals[e]=i;var n=this.vertices[this.faces[e][0]];if(i.dot(n)<0){console.error(".faceNormals["+e+"] = Vec3("+i.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var o=0;o<this.faces[e].length;o++)console.warn(".vertices["+this.faces[e][o]+"] = Vec3("+this.vertices[this.faces[e][o]].toString()+")")}}}},{key:"getFaceNormal",value:function(e,t){var n=this.faces[e],o=this.vertices[n[0]],a=this.vertices[n[1]],r=this.vertices[n[2]];i.computeNormal(o,a,r,t)}},{key:"clipAgainstHull",value:function(e,t,i,n,o,a,r,s,l){for(var u=new h,c=-1,v=-Number.MAX_VALUE,d=0;d<i.faces.length;d++){u.copy(i.faceNormals[d]),o.vmult(u,u);var p=u.dot(a);p>v&&(v=p,c=d)}for(var y=[],f=0;f<i.faces[c].length;f++){var m=i.vertices[i.faces[c][f]],b=new h;b.copy(m),o.vmult(b,b),n.vadd(b,b),y.push(b)}c>=0&&this.clipFaceAgainstHull(a,e,t,y,r,s,l)}},{key:"findSeparatingAxis",value:function(e,t,i,n,o,a,r,s){var l=new h,u=new h,c=new h,v=new h,d=new h,p=new h,y=Number.MAX_VALUE,f=this;if(f.uniqueAxes)for(var m=0;m!==f.uniqueAxes.length;m++){i.vmult(f.uniqueAxes[m],l);var b=f.testSepAxis(l,e,t,i,n,o);if(!1===b)return!1;b<y&&(y=b,a.copy(l))}else for(var w=r?r.length:f.faces.length,g=0;g<w;g++){var x=r?r[g]:g;l.copy(f.faceNormals[x]),i.vmult(l,l);var E=f.testSepAxis(l,e,t,i,n,o);if(!1===E)return!1;E<y&&(y=E,a.copy(l))}if(e.uniqueAxes)for(var k=0;k!==e.uniqueAxes.length;k++){o.vmult(e.uniqueAxes[k],u);var z=f.testSepAxis(u,e,t,i,n,o);if(!1===z)return!1;z<y&&(y=z,a.copy(u))}else for(var S=s?s.length:e.faces.length,A=0;A<S;A++){var j=s?s[A]:A;u.copy(e.faceNormals[j]),o.vmult(u,u);var O=f.testSepAxis(u,e,t,i,n,o);if(!1===O)return!1;O<y&&(y=O,a.copy(u))}for(var B=0;B!==f.uniqueEdges.length;B++){i.vmult(f.uniqueEdges[B],v);for(var C=0;C!==e.uniqueEdges.length;C++)if(o.vmult(e.uniqueEdges[C],d),v.cross(d,p),!p.almostZero()){p.normalize();var M=f.testSepAxis(p,e,t,i,n,o);if(!1===M)return!1;M<y&&(y=M,a.copy(p))}}return n.vsub(t,c),c.dot(a)>0&&a.negate(a),!0}},{key:"testSepAxis",value:function(e,t,n,o,a,r){var s=this;i.project(s,e,n,o,j),i.project(t,e,a,r,O);var l=j[0],u=j[1],h=O[0],c=O[1];if(l<c||h<u)return!1;var v=l-c,d=h-u,p=v<d?v:d;return p}},{key:"calculateLocalInertia",value:function(e,t){var i=new h,n=new h;this.computeLocalAABB(n,i);var o=i.x-n.x,a=i.y-n.y,r=i.z-n.z;t.x=1/12*e*(2*a*2*a+2*r*2*r),t.y=1/12*e*(2*o*2*o+2*r*2*r),t.z=1/12*e*(2*a*2*a+2*o*2*o)}},{key:"getPlaneConstantOfFace",value:function(e){var t=this.faces[e],i=this.faceNormals[e],n=this.vertices[t[0]],o=-i.dot(n);return o}},{key:"clipFaceAgainstHull",value:function(e,t,i,n,o,a,r){for(var s=new h,l=new h,u=new h,c=new h,v=new h,d=new h,p=new h,y=new h,f=this,m=[],b=n,w=m,g=-1,x=Number.MAX_VALUE,E=0;E<f.faces.length;E++){s.copy(f.faceNormals[E]),i.vmult(s,s);var k=s.dot(e);k<x&&(x=k,g=E)}if(!(g<0)){var z=f.faces[g];z.connectedFaces=[];for(var S=0;S<f.faces.length;S++)for(var A=0;A<f.faces[S].length;A++)-1!==z.indexOf(f.faces[S][A])&&S!==g&&-1===z.connectedFaces.indexOf(S)&&z.connectedFaces.push(S);for(var j=z.length,O=0;O<j;O++){var B=f.vertices[z[O]],C=f.vertices[z[(O+1)%j]];B.vsub(C,l),u.copy(l),i.vmult(u,u),t.vadd(u,u),c.copy(this.faceNormals[g]),i.vmult(c,c),t.vadd(c,c),u.cross(c,v),v.negate(v),d.copy(B),i.vmult(d,d),t.vadd(d,d);var M=z.connectedFaces[O];p.copy(this.faceNormals[M]);var N=this.getPlaneConstantOfFace(M);y.copy(p),i.vmult(y,y);var P=N-y.dot(t);this.clipFaceAgainstPlane(b,w,y,P);while(b.length)b.shift();while(w.length)b.push(w.shift())}p.copy(this.faceNormals[g]);var R=this.getPlaneConstantOfFace(g);y.copy(p),i.vmult(y,y);for(var T=R-y.dot(t),F=0;F<b.length;F++){var L=y.dot(b[F])+T;if(L<=o&&(console.log("clamped: depth="+L+" to minDist="+o),L=o),L<=a){var q=b[F];if(L<=1e-6){var I={point:q,normal:y,depth:L};r.push(I)}}}}}},{key:"clipFaceAgainstPlane",value:function(e,t,i,n){var o,a,r=e.length;if(r<2)return t;var s=e[e.length-1],l=e[0];o=i.dot(s)+n;for(var u=0;u<r;u++){if(l=e[u],a=i.dot(l)+n,o<0)if(a<0){var c=new h;c.copy(l),t.push(c)}else{var v=new h;s.lerp(l,o/(o-a),v),t.push(v)}else if(a<0){var d=new h;s.lerp(l,o/(o-a),d),t.push(d),t.push(l)}s=l,o=a}return t}},{key:"computeWorldVertices",value:function(e,t){while(this.worldVertices.length<this.vertices.length)this.worldVertices.push(new h);for(var i=this.vertices,n=this.worldVertices,o=0;o!==this.vertices.length;o++)t.vmult(i[o],n[o]),e.vadd(n[o],n[o]);this.worldVerticesNeedsUpdate=!1}},{key:"computeLocalAABB",value:function(e,t){var i=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var n=0;n<this.vertices.length;n++){var o=i[n];o.x<e.x?e.x=o.x:o.x>t.x&&(t.x=o.x),o.y<e.y?e.y=o.y:o.y>t.y&&(t.y=o.y),o.z<e.z?e.z=o.z:o.z>t.z&&(t.z=o.z)}}},{key:"computeWorldFaceNormals",value:function(e){var t=this.faceNormals.length;while(this.worldFaceNormals.length<t)this.worldFaceNormals.push(new h);for(var i=this.faceNormals,n=this.worldFaceNormals,o=0;o!==t;o++)e.vmult(i[o],n[o]);this.worldFaceNormalsNeedsUpdate=!1}},{key:"updateBoundingSphereRadius",value:function(){for(var e=0,t=this.vertices,i=0;i!==t.length;i++){var n=t[i].lengthSquared();n>e&&(e=n)}this.boundingSphereRadius=Math.sqrt(e)}},{key:"calculateWorldAABB",value:function(e,t,i,n){for(var o,a,r,s,l,u,c=this.vertices,v=new h,d=0;d<c.length;d++){v.copy(c[d]),t.vmult(v,v),e.vadd(v,v);var p=v;(void 0===o||p.x<o)&&(o=p.x),(void 0===s||p.x>s)&&(s=p.x),(void 0===a||p.y<a)&&(a=p.y),(void 0===l||p.y>l)&&(l=p.y),(void 0===r||p.z<r)&&(r=p.z),(void 0===u||p.z>u)&&(u=p.z)}i.set(o,a,r),n.set(s,l,u)}},{key:"volume",value:function(){return 4*Math.PI*this.boundingSphereRadius/3}},{key:"getAveragePointLocal",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new h,t=this.vertices,i=0;i<t.length;i++)e.vadd(t[i],e);return e.scale(1/t.length,e),e}},{key:"transformAllPoints",value:function(e,t){var i=this.vertices.length,n=this.vertices;if(t){for(var o=0;o<i;o++){var a=n[o];t.vmult(a,a)}for(var r=0;r<this.faceNormals.length;r++){var s=this.faceNormals[r];t.vmult(s,s)}}if(e)for(var l=0;l<i;l++){var u=n[l];u.vadd(e,u)}}},{key:"pointIsInside",value:function(e){var t=this.vertices,i=this.faces,n=this.faceNormals,o=new h;this.getAveragePointLocal(o);for(var a=0;a<this.faces.length;a++){var r=n[a],s=t[i[a][0]],l=new h;e.vsub(s,l);var u=r.dot(l),c=new h;o.vsub(s,c);var v=r.dot(c);if(u<0&&v>0||u>0&&v<0)return!1}return-1}}],[{key:"computeNormal",value:function(e,t,i,n){var o=new h,a=new h;t.vsub(e,a),i.vsub(t,o),o.cross(a,n),n.isZero()||n.normalize()}},{key:"project",value:function(e,t,i,n,o){var a=e.vertices.length,r=B,s=0,l=0,u=C,h=e.vertices;u.setZero(),z.vectorToLocalFrame(i,n,t,r),z.pointToLocalFrame(i,n,u,u);var c=u.dot(r);l=s=h[0].dot(r);for(var v=1;v<a;v++){var d=h[v].dot(r);d>s&&(s=d),d<l&&(l=d)}if(l-=c,s-=c,l>s){var p=l;l=s,s=p}o[0]=s,o[1]=l}}]),i}(k),j=[],O=[],B=new h,C=new h,M=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(e){var n;return Object(s["a"])(this,i),n=t.call(this,{type:k.types.BOX}),n.halfExtents=e,n.convexPolyhedronRepresentation=null,n.updateConvexPolyhedronRepresentation(),n.updateBoundingSphereRadius(),n}return Object(l["a"])(i,[{key:"updateConvexPolyhedronRepresentation",value:function(){var e=this.halfExtents.x,t=this.halfExtents.y,i=this.halfExtents.z,n=h,o=[new n(-e,-t,-i),new n(e,-t,-i),new n(e,t,-i),new n(-e,t,-i),new n(-e,-t,i),new n(e,-t,i),new n(e,t,i),new n(-e,t,i)],a=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],r=[new n(0,0,1),new n(0,1,0),new n(1,0,0)],s=new A({vertices:o,faces:a,axes:r});this.convexPolyhedronRepresentation=s,s.material=this.material}},{key:"calculateLocalInertia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;return i.calculateInertia(this.halfExtents,e,t),t}},{key:"getSideNormals",value:function(e,t){var i=e,n=this.halfExtents;if(i[0].set(n.x,0,0),i[1].set(0,n.y,0),i[2].set(0,0,n.z),i[3].set(-n.x,0,0),i[4].set(0,-n.y,0),i[5].set(0,0,-n.z),void 0!==t)for(var o=0;o!==i.length;o++)t.vmult(i[o],i[o]);return i}},{key:"volume",value:function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}},{key:"updateBoundingSphereRadius",value:function(){this.boundingSphereRadius=this.halfExtents.length()}},{key:"forEachWorldCorner",value:function(e,t,i){for(var n=this.halfExtents,o=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]],a=0;a<o.length;a++)N.set(o[a][0],o[a][1],o[a][2]),t.vmult(N,N),e.vadd(N,N),i(N.x,N.y,N.z)}},{key:"calculateWorldAABB",value:function(e,t,i,n){var o=this.halfExtents;P[0].set(o.x,o.y,o.z),P[1].set(-o.x,o.y,o.z),P[2].set(-o.x,-o.y,o.z),P[3].set(-o.x,-o.y,-o.z),P[4].set(o.x,-o.y,-o.z),P[5].set(o.x,o.y,-o.z),P[6].set(-o.x,o.y,-o.z),P[7].set(o.x,-o.y,o.z);var a=P[0];t.vmult(a,a),e.vadd(a,a),n.copy(a),i.copy(a);for(var r=1;r<8;r++){var s=P[r];t.vmult(s,s),e.vadd(s,s);var l=s.x,u=s.y,h=s.z;l>n.x&&(n.x=l),u>n.y&&(n.y=u),h>n.z&&(n.z=h),l<i.x&&(i.x=l),u<i.y&&(i.y=u),h<i.z&&(i.z=h)}}}],[{key:"calculateInertia",value:function(e,t,i){var n=e;i.x=1/12*t*(2*n.y*2*n.y+2*n.z*2*n.z),i.y=1/12*t*(2*n.x*2*n.x+2*n.z*2*n.z),i.z=1/12*t*(2*n.y*2*n.y+2*n.x*2*n.x)}}]),i}(k),N=new h,P=[new h,new h,new h,new h,new h,new h,new h,new h],R={AWAKE:0,SLEEPY:1,SLEEPING:2},T=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s["a"])(this,i),e=t.call(this),e.id=i.idCounter++,e.index=-1,e.world=null,e.preStep=null,e.postStep=null,e.vlambda=new h,e.collisionFilterGroup="number"===typeof n.collisionFilterGroup?n.collisionFilterGroup:1,e.collisionFilterMask="number"===typeof n.collisionFilterMask?n.collisionFilterMask:-1,e.collisionResponse="boolean"!==typeof n.collisionResponse||n.collisionResponse,e.position=new h,e.previousPosition=new h,e.interpolatedPosition=new h,e.initPosition=new h,n.position&&(e.position.copy(n.position),e.previousPosition.copy(n.position),e.interpolatedPosition.copy(n.position),e.initPosition.copy(n.position)),e.velocity=new h,n.velocity&&e.velocity.copy(n.velocity),e.initVelocity=new h,e.force=new h;var a="number"===typeof n.mass?n.mass:0;return e.mass=a,e.invMass=a>0?1/a:0,e.material=n.material||null,e.linearDamping="number"===typeof n.linearDamping?n.linearDamping:.01,e.type=a<=0?i.STATIC:i.DYNAMIC,Object(o["a"])(n.type)===Object(o["a"])(i.STATIC)&&(e.type=n.type),e.allowSleep="undefined"===typeof n.allowSleep||n.allowSleep,e.sleepState=i.AWAKE,e.sleepSpeedLimit="undefined"!==typeof n.sleepSpeedLimit?n.sleepSpeedLimit:.1,e.sleepTimeLimit="undefined"!==typeof n.sleepTimeLimit?n.sleepTimeLimit:1,e.timeLastSleepy=0,e.wakeUpAfterNarrowphase=!1,e.torque=new h,e.quaternion=new w,e.initQuaternion=new w,e.previousQuaternion=new w,e.interpolatedQuaternion=new w,n.quaternion&&(e.quaternion.copy(n.quaternion),e.initQuaternion.copy(n.quaternion),e.previousQuaternion.copy(n.quaternion),e.interpolatedQuaternion.copy(n.quaternion)),e.angularVelocity=new h,n.angularVelocity&&e.angularVelocity.copy(n.angularVelocity),e.initAngularVelocity=new h,e.shapes=[],e.shapeOffsets=[],e.shapeOrientations=[],e.inertia=new h,e.invInertia=new h,e.invInertiaWorld=new u,e.invMassSolve=0,e.invInertiaSolve=new h,e.invInertiaWorldSolve=new u,e.fixedRotation="undefined"!==typeof n.fixedRotation&&n.fixedRotation,e.angularDamping="undefined"!==typeof n.angularDamping?n.angularDamping:.01,e.linearFactor=new h(1,1,1),n.linearFactor&&e.linearFactor.copy(n.linearFactor),e.angularFactor=new h(1,1,1),n.angularFactor&&e.angularFactor.copy(n.angularFactor),e.aabb=new p,e.aabbNeedsUpdate=!0,e.boundingRadius=0,e.wlambda=new h,n.shape&&e.addShape(n.shape),e.updateMassProperties(),e}return Object(l["a"])(i,[{key:"wakeUp",value:function(){var e=this.sleepState;this.sleepState=i.AWAKE,this.wakeUpAfterNarrowphase=!1,e===i.SLEEPING&&this.dispatchEvent(i.wakeupEvent)}},{key:"sleep",value:function(){this.sleepState=i.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}},{key:"sleepTick",value:function(e){if(this.allowSleep){var t=this.sleepState,n=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),o=Math.pow(this.sleepSpeedLimit,2);t===i.AWAKE&&n<o?(this.sleepState=i.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(i.sleepyEvent)):t===i.SLEEPY&&n>o?this.wakeUp():t===i.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(i.sleepEvent))}}},{key:"updateSolveMassProperties",value:function(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}},{key:"pointToLocalFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;return e.vsub(this.position,t),this.quaternion.conjugate().vmult(t,t),t}},{key:"vectorToLocalFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;return this.quaternion.conjugate().vmult(e,t),t}},{key:"pointToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;return this.quaternion.vmult(e,t),t.vadd(this.position,t),t}},{key:"vectorToWorldFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;return this.quaternion.vmult(e,t),t}},{key:"addShape",value:function(e,t,i){var n=new h,o=new w;return t&&n.copy(t),i&&o.copy(i),this.shapes.push(e),this.shapeOffsets.push(n),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}},{key:"removeShape",value:function(e){var t=this.shapes.indexOf(e);return-1===t?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeOrientations.splice(t,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}},{key:"updateBoundingRadius",value:function(){for(var e=this.shapes,t=this.shapeOffsets,i=e.length,n=0,o=0;o!==i;o++){var a=e[o];a.updateBoundingSphereRadius();var r=t[o].length(),s=a.boundingSphereRadius;r+s>n&&(n=r+s)}this.boundingRadius=n}},{key:"updateAABB",value:function(){for(var e=this.shapes,t=this.shapeOffsets,i=this.shapeOrientations,n=e.length,o=F,a=L,r=this.quaternion,s=this.aabb,l=q,u=0;u!==n;u++){var h=e[u];r.vmult(t[u],o),o.vadd(this.position,o),r.mult(i[u],a),h.calculateWorldAABB(o,a,l.lowerBound,l.upperBound),0===u?s.copy(l):s.extend(l)}this.aabbNeedsUpdate=!1}},{key:"updateInertiaWorld",value:function(e){var t=this.invInertia;if(t.x!==t.y||t.y!==t.z||e){var i=I,n=D;i.setRotationFromQuaternion(this.quaternion),i.transpose(n),i.scale(t,i),i.mmult(n,this.invInertiaWorld)}else;}},{key:"applyForce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;if(this.type===i.DYNAMIC){this.sleepState===i.SLEEPING&&this.wakeUp();var n=W;t.cross(e,n),this.force.vadd(e,this.force),this.torque.vadd(n,this.torque)}}},{key:"applyLocalForce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;if(this.type===i.DYNAMIC){var n=H,o=V;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,o),this.applyForce(n,o)}}},{key:"applyTorque",value:function(e){this.type===i.DYNAMIC&&(this.sleepState===i.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}},{key:"applyImpulse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;if(this.type===i.DYNAMIC){this.sleepState===i.SLEEPING&&this.wakeUp();var n=t,o=Y;o.copy(e),o.scale(this.invMass,o),this.velocity.vadd(o,this.velocity);var a=_;n.cross(e,a),this.invInertiaWorld.vmult(a,a),this.angularVelocity.vadd(a,this.angularVelocity)}}},{key:"applyLocalImpulse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;if(this.type===i.DYNAMIC){var n=U,o=X;this.vectorToWorldFrame(e,n),this.vectorToWorldFrame(t,o),this.applyImpulse(n,o)}}},{key:"updateMassProperties",value:function(){var e=G;this.invMass=this.mass>0?1/this.mass:0;var t=this.inertia,i=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),M.calculateInertia(e,this.mass,t),this.invInertia.set(t.x>0&&!i?1/t.x:0,t.y>0&&!i?1/t.y:0,t.z>0&&!i?1/t.z:0),this.updateInertiaWorld(!0)}},{key:"getVelocityAtWorldPoint",value:function(e,t){var i=new h;return e.vsub(this.position,i),this.angularVelocity.cross(i,t),this.velocity.vadd(t,t),t}},{key:"integrate",value:function(e,t,n){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===i.DYNAMIC||this.type===i.KINEMATIC)&&this.sleepState!==i.SLEEPING){var o=this.velocity,a=this.angularVelocity,r=this.position,s=this.force,l=this.torque,u=this.quaternion,h=this.invMass,c=this.invInertiaWorld,v=this.linearFactor,d=h*e;o.x+=s.x*d*v.x,o.y+=s.y*d*v.y,o.z+=s.z*d*v.z;var p=c.elements,y=this.angularFactor,f=l.x*y.x,m=l.y*y.y,b=l.z*y.z;a.x+=e*(p[0]*f+p[1]*m+p[2]*b),a.y+=e*(p[3]*f+p[4]*m+p[5]*b),a.z+=e*(p[6]*f+p[7]*m+p[8]*b),r.x+=o.x*e,r.y+=o.y*e,r.z+=o.z*e,u.integrate(this.angularVelocity,e,this.angularFactor,u),t&&(n?u.normalizeFast():u.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}}]),i}(b);T.COLLIDE_EVENT_NAME="collide",T.DYNAMIC=1,T.STATIC=2,T.KINEMATIC=4,T.AWAKE=R.AWAKE,T.SLEEPY=R.SLEEPY,T.SLEEPING=R.SLEEPING,T.idCounter=0,T.wakeupEvent={type:"wakeup"},T.sleepyEvent={type:"sleepy"},T.sleepEvent={type:"sleep"};var F=new h,L=new w,q=new p,I=new u,D=new u,W=new h,H=new h,V=new h,Y=new h,_=new h,U=new h,X=new h,G=new h,Z=function(){function e(){Object(s["a"])(this,e),this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}return Object(l["a"])(e,[{key:"collisionPairs",value:function(e,t,i){throw new Error("collisionPairs not implemented for this BroadPhase class!")}},{key:"needBroadphaseCollision",value:function(e,t){return 0!==(e.collisionFilterGroup&t.collisionFilterMask)&&0!==(t.collisionFilterGroup&e.collisionFilterMask)&&(0===(e.type&T.STATIC)&&e.sleepState!==T.SLEEPING||0===(t.type&T.STATIC)&&t.sleepState!==T.SLEEPING)}},{key:"intersectionTest",value:function(e,t,i,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,t,i,n):this.doBoundingSphereBroadphase(e,t,i,n)}},{key:"doBoundingSphereBroadphase",value:function(e,t,i,n){var o=K;t.position.vsub(e.position,o);var a=Math.pow(e.boundingRadius+t.boundingRadius,2),r=o.lengthSquared();r<a&&(i.push(e),n.push(t))}},{key:"doBoundingBoxBroadphase",value:function(e,t,i,n){e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.aabb.overlaps(t.aabb)&&(i.push(e),n.push(t))}},{key:"makePairsUnique",value:function(e,t){for(var i=Q,n=J,o=$,a=e.length,r=0;r!==a;r++)n[r]=e[r],o[r]=t[r];e.length=0,t.length=0;for(var s=0;s!==a;s++){var l=n[s].id,u=o[s].id,h=l<u?l+","+u:u+","+l;i[h]=s,i.keys.push(h)}for(var c=0;c!==i.keys.length;c++){var v=i.keys.pop(),d=i[v];e.push(n[d]),t.push(o[d]),delete i[v]}}},{key:"setWorld",value:function(e){}},{key:"aabbQuery",value:function(e,t,i){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}],[{key:"boundingSphereCheck",value:function(e,t){var i=new h;e.position.vsub(t.position,i);var n=e.shapes[0],o=t.shapes[0];return Math.pow(n.boundingSphereRadius+o.boundingSphereRadius,2)>i.lengthSquared()}}]),e}(),K=new h,Q={keys:[]},J=[],$=[],ee=(new h,function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(){return Object(s["a"])(this,i),t.call(this)}return Object(l["a"])(i,[{key:"collisionPairs",value:function(e,t,i){for(var n,o,a=e.bodies,r=a.length,s=0;s!==r;s++)for(var l=0;l!==s;l++)n=a[s],o=a[l],this.needBroadphaseCollision(n,o)&&this.intersectionTest(n,o,t,i)}},{key:"aabbQuery",value:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=0;n<e.bodies.length;n++){var o=e.bodies[n];o.aabbNeedsUpdate&&o.updateAABB(),o.aabb.overlaps(t)&&i.push(o)}return i}}]),i}(Z)),te=function(){function e(){Object(s["a"])(this,e),this.rayFromWorld=new h,this.rayToWorld=new h,this.hitNormalWorld=new h,this.hitPointWorld=new h,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}return Object(l["a"])(e,[{key:"reset",value:function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}},{key:"abort",value:function(){this.shouldStop=!0}},{key:"set",value:function(e,t,i,n,o,a,r){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(n),this.shape=o,this.body=a,this.distance=r}}]),e}(),ie=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new h,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;Object(s["a"])(this,e),this.from=t.clone(),this.to=i.clone(),this.direction=new h,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=e.ANY,this.result=new te,this.hasHit=!1,this.callback=function(e){}}return Object(l["a"])(e,[{key:"intersectWorld",value:function(t,i){return this.mode=i.mode||e.ANY,this.result=i.result||new te,this.skipBackfaces=!!i.skipBackfaces,this.collisionFilterMask="undefined"!==typeof i.collisionFilterMask?i.collisionFilterMask:-1,this.collisionFilterGroup="undefined"!==typeof i.collisionFilterGroup?i.collisionFilterGroup:-1,this.checkCollisionResponse="undefined"===typeof i.checkCollisionResponse||i.checkCollisionResponse,i.from&&this.from.copy(i.from),i.to&&this.to.copy(i.to),this.callback=i.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(ne),oe.length=0,t.broadphase.aabbQuery(t,ne,oe),this.intersectBodies(oe),this.hasHit}},{key:"intersectBody",value:function(e,t){t&&(this.result=t,this.updateDirection());var i=this.checkCollisionResponse;if((!i||e.collisionResponse)&&0!==(this.collisionFilterGroup&e.collisionFilterMask)&&0!==(e.collisionFilterGroup&this.collisionFilterMask))for(var n=le,o=ue,a=0,r=e.shapes.length;a<r;a++){var s=e.shapes[a];if((!i||s.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[a],o),e.quaternion.vmult(e.shapeOffsets[a],n),n.vadd(e.position,n),this.intersectShape(s,o,n,e),this.result.shouldStop))break}}},{key:"intersectBodies",value:function(e,t){t&&(this.result=t,this.updateDirection());for(var i=0,n=e.length;!this.result.shouldStop&&i<n;i++)this.intersectBody(e[i])}},{key:"updateDirection",value:function(){this.to.vsub(this.from,this.direction),this.direction.normalize()}},{key:"intersectShape",value:function(e,t,i,n){var o=this.from,a=Ne(o,this.direction,i);if(!(a>e.boundingSphereRadius)){var r=this[e.type];r&&r.call(this,e,t,i,n,e)}}},{key:"_intersectBox",value:function(e,t,i,n,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,n,o)}},{key:"_intersectPlane",value:function(e,t,i,n,o){var a=this.from,r=this.to,s=this.direction,l=new h(0,0,1);t.vmult(l,l);var u=new h;a.vsub(i,u);var c=u.dot(l);r.vsub(i,u);var v=u.dot(l);if(!(c*v>0)&&!(a.distanceTo(r)<c)){var d=l.dot(s);if(!(Math.abs(d)<this.precision)){var p=new h,y=new h,f=new h;a.vsub(i,p);var m=-l.dot(p)/d;s.scale(m,y),a.vadd(y,f),this.reportIntersection(l,f,o,n,-1)}}}},{key:"getAABB",value:function(e){var t=e.lowerBound,i=e.upperBound,n=this.to,o=this.from;t.x=Math.min(n.x,o.x),t.y=Math.min(n.y,o.y),t.z=Math.min(n.z,o.z),i.x=Math.max(n.x,o.x),i.y=Math.max(n.y,o.y),i.z=Math.max(n.z,o.z)}},{key:"_intersectHeightfield",value:function(e,t,i,n,o){e.data,e.elementSize;var a=fe;a.from.copy(this.from),a.to.copy(this.to),z.pointToLocalFrame(i,t,a.from,a.from),z.pointToLocalFrame(i,t,a.to,a.to),a.updateDirection();var r,s,l,u,h=me;r=s=0,l=u=e.data.length-1;var c=new p;a.getAABB(c),e.getIndexOfPosition(c.lowerBound.x,c.lowerBound.y,h,!0),r=Math.max(r,h[0]),s=Math.max(s,h[1]),e.getIndexOfPosition(c.upperBound.x,c.upperBound.y,h,!0),l=Math.min(l,h[0]+1),u=Math.min(u,h[1]+1);for(var v=r;v<l;v++)for(var d=s;d<u;d++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(v,d,c),c.overlapsRay(a)){if(e.getConvexTrianglePillar(v,d,!1),z.pointToWorldFrame(i,t,e.pillarOffset,ye),this._intersectConvex(e.pillarConvex,t,ye,n,o,pe),this.result.shouldStop)return;e.getConvexTrianglePillar(v,d,!0),z.pointToWorldFrame(i,t,e.pillarOffset,ye),this._intersectConvex(e.pillarConvex,t,ye,n,o,pe)}}}},{key:"_intersectSphere",value:function(e,t,i,n,o){var a=this.from,r=this.to,s=e.radius,l=Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2)+Math.pow(r.z-a.z,2),u=2*((r.x-a.x)*(a.x-i.x)+(r.y-a.y)*(a.y-i.y)+(r.z-a.z)*(a.z-i.z)),h=Math.pow(a.x-i.x,2)+Math.pow(a.y-i.y,2)+Math.pow(a.z-i.z,2)-Math.pow(s,2),c=Math.pow(u,2)-4*l*h,v=be,d=we;if(!(c<0))if(0===c)a.lerp(r,c,v),v.vsub(i,d),d.normalize(),this.reportIntersection(d,v,o,n,-1);else{var p=(-u-Math.sqrt(c))/(2*l),y=(-u+Math.sqrt(c))/(2*l);if(p>=0&&p<=1&&(a.lerp(r,p,v),v.vsub(i,d),d.normalize(),this.reportIntersection(d,v,o,n,-1)),this.result.shouldStop)return;y>=0&&y<=1&&(a.lerp(r,y,v),v.vsub(i,d),d.normalize(),this.reportIntersection(d,v,o,n,-1))}}},{key:"_intersectConvex",value:function(e,t,i,n,o,a){for(var r=ge,s=xe,l=a&&a.faceList||null,u=e.faces,h=e.vertices,c=e.faceNormals,v=this.direction,d=this.from,p=this.to,y=d.distanceTo(p),f=l?l.length:u.length,m=this.result,b=0;!m.shouldStop&&b<f;b++){var w=l?l[b]:b,g=u[w],x=c[w],E=t,k=i;s.copy(h[g[0]]),E.vmult(s,s),s.vadd(k,s),s.vsub(d,s),E.vmult(x,r);var z=v.dot(r);if(!(Math.abs(z)<this.precision)){var S=r.dot(s)/z;if(!(S<0)){v.scale(S,he),he.vadd(d,he),ce.copy(h[g[0]]),E.vmult(ce,ce),k.vadd(ce,ce);for(var A=1;!m.shouldStop&&A<g.length-1;A++){ve.copy(h[g[A]]),de.copy(h[g[A+1]]),E.vmult(ve,ve),E.vmult(de,de),k.vadd(ve,ve),k.vadd(de,de);var j=he.distanceTo(d);!se(he,ce,ve,de)&&!se(he,ve,ce,de)||j>y||this.reportIntersection(r,he,o,n,w)}}}}}},{key:"_intersectTrimesh",value:function(e,t,i,n,o,a){var r=Ee,s=Oe,l=Be,u=xe,h=ke,c=ze,v=Se,d=je,p=Ae,y=(a&&a.faceList,e.indices),f=(e.vertices,this.from),m=this.to,b=this.direction;l.position.copy(i),l.quaternion.copy(t),z.vectorToLocalFrame(i,t,b,h),z.pointToLocalFrame(i,t,f,c),z.pointToLocalFrame(i,t,m,v),v.x*=e.scale.x,v.y*=e.scale.y,v.z*=e.scale.z,c.x*=e.scale.x,c.y*=e.scale.y,c.z*=e.scale.z,v.vsub(c,h),h.normalize();var w=c.distanceSquared(v);e.tree.rayQuery(this,l,s);for(var g=0,x=s.length;!this.result.shouldStop&&g!==x;g++){var E=s[g];e.getNormal(E,r),e.getVertex(y[3*E],ce),ce.vsub(c,u);var k=h.dot(r),S=r.dot(u)/k;if(!(S<0)){h.scale(S,he),he.vadd(c,he),e.getVertex(y[3*E+1],ve),e.getVertex(y[3*E+2],de);var A=he.distanceSquared(c);!se(he,ve,ce,de)&&!se(he,ce,ve,de)||A>w||(z.vectorToWorldFrame(t,r,p),z.pointToWorldFrame(i,t,he,d),this.reportIntersection(p,d,o,n,E))}}s.length=0}},{key:"reportIntersection",value:function(t,i,n,o,a){var r=this.from,s=this.to,l=r.distanceTo(i),u=this.result;if(!(this.skipBackfaces&&t.dot(this.direction)>0))switch(u.hitFaceIndex="undefined"!==typeof a?a:-1,this.mode){case e.ALL:this.hasHit=!0,u.set(r,s,t,i,n,o,l),u.hasHit=!0,this.callback(u);break;case e.CLOSEST:(l<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(r,s,t,i,n,o,l));break;case e.ANY:this.hasHit=!0,u.hasHit=!0,u.set(r,s,t,i,n,o,l),u.shouldStop=!0;break}}}]),e}();ie.CLOSEST=1,ie.ANY=2,ie.ALL=4;var ne=new p,oe=[],ae=new h,re=new h;function se(e,t,i,n){n.vsub(t,Ce),i.vsub(t,ae),e.vsub(t,re);var o,a,r=Ce.dot(Ce),s=Ce.dot(ae),l=Ce.dot(re),u=ae.dot(ae),h=ae.dot(re);return(o=u*l-s*h)>=0&&(a=r*h-s*l)>=0&&o+a<r*u-s*s}ie.pointInTriangle=se;var le=new h,ue=new w,he=new h,ce=new h,ve=new h,de=new h;ie.prototype[k.types.BOX]=ie.prototype._intersectBox,ie.prototype[k.types.PLANE]=ie.prototype._intersectPlane;var pe={faceList:[0]},ye=new h,fe=new ie,me=[];ie.prototype[k.types.HEIGHTFIELD]=ie.prototype._intersectHeightfield;var be=new h,we=new h;ie.prototype[k.types.SPHERE]=ie.prototype._intersectSphere;var ge=new h,xe=new h;ie.prototype[k.types.CYLINDER]=ie.prototype._intersectConvex,ie.prototype[k.types.CONVEXPOLYHEDRON]=ie.prototype._intersectConvex;var Ee=new h,ke=new h,ze=new h,Se=new h,Ae=new h,je=new h,Oe=(new p,[]),Be=new z;ie.prototype[k.types.TRIMESH]=ie.prototype._intersectTrimesh;var Ce=new h,Me=new h;function Ne(e,t,i){i.vsub(e,Ce);var n=Ce.dot(t);t.scale(n,Me),Me.vadd(e,Me);var o=i.distanceTo(Me);return o}var Pe=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(e){var n;Object(s["a"])(this,i),n=t.call(this),n.axisList=[],n.world=null,n.axisIndex=0;var o=n.axisList;return n._addBodyHandler=function(e){o.push(e.body)},n._removeBodyHandler=function(e){var t=o.indexOf(e.body);-1!==t&&o.splice(t,1)},e&&n.setWorld(e),n}return Object(l["a"])(i,[{key:"setWorld",value:function(e){this.axisList.length=0;for(var t=0;t<e.bodies.length;t++)this.axisList.push(e.bodies[t]);e.removeEventListener("addBody",this._addBodyHandler),e.removeEventListener("removeBody",this._removeBodyHandler),e.addEventListener("addBody",this._addBodyHandler),e.addEventListener("removeBody",this._removeBodyHandler),this.world=e,this.dirty=!0}},{key:"collisionPairs",value:function(e,t,n){var o,a,r=this.axisList,s=r.length,l=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),o=0;o!==s;o++){var u=r[o];for(a=o+1;a<s;a++){var h=r[a];if(this.needBroadphaseCollision(u,h)){if(!i.checkBounds(u,h,l))break;this.intersectionTest(u,h,t,n)}}}}},{key:"sortList",value:function(){for(var e=this.axisList,t=this.axisIndex,n=e.length,o=0;o!==n;o++){var a=e[o];a.aabbNeedsUpdate&&a.updateAABB()}0===t?i.insertionSortX(e):1===t?i.insertionSortY(e):2===t&&i.insertionSortZ(e)}},{key:"autoDetectAxis",value:function(){for(var e=0,t=0,i=0,n=0,o=0,a=0,r=this.axisList,s=r.length,l=1/s,u=0;u!==s;u++){var h=r[u],c=h.position.x;e+=c,t+=c*c;var v=h.position.y;i+=v,n+=v*v;var d=h.position.z;o+=d,a+=d*d}var p=t-e*e*l,y=n-i*i*l,f=a-o*o*l;this.axisIndex=p>y?p>f?0:2:y>f?1:2}},{key:"aabbQuery",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.dirty&&(this.sortList(),this.dirty=!1);var n=this.axisIndex,o="x";1===n&&(o="y"),2===n&&(o="z");for(var a=this.axisList,r=(t.lowerBound[o],t.upperBound[o],0);r<a.length;r++){var s=a[r];s.aabbNeedsUpdate&&s.updateAABB(),s.aabb.overlaps(t)&&i.push(s)}return i}}]),i}(Z);Pe.insertionSortX=function(e){for(var t=1,i=e.length;t<i;t++){var n=e[t],o=void 0;for(o=t-1;o>=0;o--){if(e[o].aabb.lowerBound.x<=n.aabb.lowerBound.x)break;e[o+1]=e[o]}e[o+1]=n}return e},Pe.insertionSortY=function(e){for(var t=1,i=e.length;t<i;t++){var n=e[t],o=void 0;for(o=t-1;o>=0;o--){if(e[o].aabb.lowerBound.y<=n.aabb.lowerBound.y)break;e[o+1]=e[o]}e[o+1]=n}return e},Pe.insertionSortZ=function(e){for(var t=1,i=e.length;t<i;t++){var n=e[t],o=void 0;for(o=t-1;o>=0;o--){if(e[o].aabb.lowerBound.z<=n.aabb.lowerBound.z)break;e[o+1]=e[o]}e[o+1]=n}return e},Pe.checkBounds=function(e,t,i){var n,o;0===i?(n=e.position.x,o=t.position.x):1===i?(n=e.position.y,o=t.position.y):2===i&&(n=e.position.z,o=t.position.z);var a=e.boundingRadius,r=t.boundingRadius,s=n+a,l=o-r;return l<s};var Re=function(){function e(){Object(s["a"])(this,e)}return Object(l["a"])(e,null,[{key:"defaults",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;for(var i in t)i in e||(e[i]=t[i]);return e}}]),e}(),Te=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(s["a"])(this,e),n=Re.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=i,this.id=e.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),i&&i.wakeUp())}return Object(l["a"])(e,[{key:"update",value:function(){throw new Error("method update() not implmemented in this Constraint subclass!")}},{key:"enable",value:function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!0}},{key:"disable",value:function(){for(var e=this.equations,t=0;t<e.length;t++)e[t].enabled=!1}}]),e}();Te.idCounter=0;var Fe=function(){function e(){Object(s["a"])(this,e),this.spatial=new h,this.rotational=new h}return Object(l["a"])(e,[{key:"multiplyElement",value:function(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}},{key:"multiplyVectors",value:function(e,t){return e.dot(this.spatial)+t.dot(this.rotational)}}]),e}(),Le=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1e6,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e6;Object(s["a"])(this,e),this.id=e.id++,this.minForce=n,this.maxForce=o,this.bi=t,this.bj=i,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Fe,this.jacobianElementB=new Fe,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}return Object(l["a"])(e,[{key:"setSpookParams",value:function(e,t,i){var n=t,o=e,a=i;this.a=4/(a*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(a*a*o*(1+4*n))}},{key:"computeB",value:function(e,t,i){var n=this.computeGW(),o=this.computeGq(),a=this.computeGiMf();return-o*e-n*t-a*i}},{key:"computeGq",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.position,a=n.position;return e.spatial.dot(o)+t.spatial.dot(a)}},{key:"computeGW",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.velocity,a=n.velocity,r=i.angularVelocity,s=n.angularVelocity;return e.multiplyVectors(o,r)+t.multiplyVectors(a,s)}},{key:"computeGWlambda",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.vlambda,a=n.vlambda,r=i.wlambda,s=n.wlambda;return e.multiplyVectors(o,r)+t.multiplyVectors(a,s)}},{key:"computeGiMf",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.force,a=i.torque,r=n.force,s=n.torque,l=i.invMassSolve,u=n.invMassSolve;return o.scale(l,qe),r.scale(u,Ie),i.invInertiaWorldSolve.vmult(a,De),n.invInertiaWorldSolve.vmult(s,We),e.multiplyVectors(qe,De)+t.multiplyVectors(Ie,We)}},{key:"computeGiMGt",value:function(){var e=this.jacobianElementA,t=this.jacobianElementB,i=this.bi,n=this.bj,o=i.invMassSolve,a=n.invMassSolve,r=i.invInertiaWorldSolve,s=n.invInertiaWorldSolve,l=o+a;return r.vmult(e.rotational,He),l+=He.dot(e.rotational),s.vmult(t.rotational,He),l+=He.dot(t.rotational),l}},{key:"addToWlambda",value:function(e){var t=this.jacobianElementA,i=this.jacobianElementB,n=this.bi,o=this.bj,a=Ve;n.vlambda.addScaledVector(n.invMassSolve*e,t.spatial,n.vlambda),o.vlambda.addScaledVector(o.invMassSolve*e,i.spatial,o.vlambda),n.invInertiaWorldSolve.vmult(t.rotational,a),n.wlambda.addScaledVector(e,a,n.wlambda),o.invInertiaWorldSolve.vmult(i.rotational,a),o.wlambda.addScaledVector(e,a,o.wlambda)}},{key:"computeC",value:function(){return this.computeGiMGt()+this.eps}}]),e}();Le.id=0;var qe=new h,Ie=new h,De=new h,We=new h,He=new h,Ve=new h,Ye=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(e,n){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e6;return Object(s["a"])(this,i),o=t.call(this,e,n,0,a),o.restitution=0,o.ri=new h,o.rj=new h,o.ni=new h,o}return Object(l["a"])(i,[{key:"computeB",value:function(e){var t=this.a,i=this.b,n=this.bi,o=this.bj,a=this.ri,r=this.rj,s=_e,l=Ue,u=n.velocity,h=n.angularVelocity,c=(n.force,n.torque,o.velocity),v=o.angularVelocity,d=(o.force,o.torque,Xe),p=this.jacobianElementA,y=this.jacobianElementB,f=this.ni;a.cross(f,s),r.cross(f,l),f.negate(p.spatial),s.negate(p.rotational),y.spatial.copy(f),y.rotational.copy(l),d.copy(o.position),d.vadd(r,d),d.vsub(n.position,d),d.vsub(a,d);var m=f.dot(d),b=this.restitution+1,w=b*c.dot(f)-b*u.dot(f)+v.dot(l)-h.dot(s),g=this.computeGiMf(),x=-m*t-w*i-e*g;return x}},{key:"getImpactVelocityAlongNormal",value:function(){var e=Ge,t=Ze,i=Ke,n=Qe,o=Je;return this.bi.position.vadd(this.ri,i),this.bj.position.vadd(this.rj,n),this.bi.getVelocityAtWorldPoint(i,e),this.bj.getVelocityAtWorldPoint(n,t),e.vsub(t,o),this.ni.dot(o)}}]),i}(Le),_e=new h,Ue=new h,Xe=new h,Ge=new h,Ze=new h,Ke=new h,Qe=new h,Je=new h,$e=(new h,new h,new h,new h,new h,new h,function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(e,n,o){var a;return Object(s["a"])(this,i),a=t.call(this,e,n,-o,o),a.ri=new h,a.rj=new h,a.t=new h,a}return Object(l["a"])(i,[{key:"computeB",value:function(e){this.a;var t=this.b,i=(this.bi,this.bj,this.ri),n=this.rj,o=et,a=tt,r=this.t;i.cross(r,o),n.cross(r,a);var s=this.jacobianElementA,l=this.jacobianElementB;r.negate(s.spatial),o.negate(s.rotational),l.spatial.copy(r),l.rotational.copy(a);var u=this.computeGW(),h=this.computeGiMf(),c=-u*t-e*h;return c}}]),i}(Le)),et=new h,tt=new h,it=function e(t,i,n){Object(s["a"])(this,e),n=Re.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=e.idCounter++,this.materials=[t,i],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation};it.idCounter=0;var nt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s["a"])(this,e);var i="";"string"===typeof t&&(i=t,t={}),this.name=i,this.id=e.idCounter++,this.friction="undefined"!==typeof t.friction?t.friction:-1,this.restitution="undefined"!==typeof t.restitution?t.restitution:-1};nt.idCounter=0;new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new h,new ie,new h,new h,new h(1,0,0),new h(0,1,0),new h(0,0,1),new h,new h,new h,new h;new h,new h,new h,new h;new h,new h,new h;new h,new h,new h,new h,new h,new h,new h,new h,new h;var ot=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;if(Object(s["a"])(this,i),n<0)throw new Error("The cylinder radiusTop cannot be negative.");if(o<0)throw new Error("The cylinder radiusBottom cannot be negative.");var l=r,u=[],c=[],v=[],d=[],p=[],y=Math.cos,f=Math.sin;u.push(new h(-o*f(0),.5*-a,o*y(0))),d.push(0),u.push(new h(-n*f(0),.5*a,n*y(0))),p.push(1);for(var m=0;m<l;m++){var b=2*Math.PI/l*(m+1),w=2*Math.PI/l*(m+.5);m<l-1?(u.push(new h(-o*f(b),.5*-a,o*y(b))),d.push(2*m+2),u.push(new h(-n*f(b),.5*a,n*y(b))),p.push(2*m+3),v.push([2*m,2*m+1,2*m+3,2*m+2])):v.push([2*m,2*m+1,1,0]),(l%2===1||m<l/2)&&c.push(new h(-f(w),0,y(w)))}v.push(d),c.push(new h(0,1,0));for(var g=[],x=0;x<p.length;x++)g.push(p[p.length-x-1]);return v.push(g),e=t.call(this,{vertices:u,faces:v,axes:c}),e.type=k.types.CYLINDER,e.radiusTop=n,e.radiusBottom=o,e.height=a,e.numSegments=r,e}return i}(A),at=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(){var e;return Object(s["a"])(this,i),e=t.call(this,{type:k.types.PLANE}),e.worldNormal=new h,e.worldNormalNeedsUpdate=!0,e.boundingSphereRadius=Number.MAX_VALUE,e}return Object(l["a"])(i,[{key:"computeWorldNormal",value:function(e){var t=this.worldNormal;t.set(0,0,1),e.vmult(t,t),this.worldNormalNeedsUpdate=!1}},{key:"calculateLocalInertia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h;return t}},{key:"volume",value:function(){return Number.MAX_VALUE}},{key:"calculateWorldAABB",value:function(e,t,i,n){rt.set(0,0,1),t.vmult(rt,rt);var o=Number.MAX_VALUE;i.set(-o,-o,-o),n.set(o,o,o),1===rt.x?n.x=e.x:-1===rt.x&&(i.x=e.x),1===rt.y?n.y=e.y:-1===rt.y&&(i.y=e.y),1===rt.z?n.z=e.z:-1===rt.z&&(i.z=e.z)}},{key:"updateBoundingSphereRadius",value:function(){this.boundingSphereRadius=Number.MAX_VALUE}}]),i}(k),rt=new h;new h,new h,new h,new h,new h,new h,new h,new h,new h;new h,new p,new h,new p,new h,new h,new h,new h,new h,new h,new h,new p,new h,new z,new p;var st=function(){function e(){Object(s["a"])(this,e),this.equations=[]}return Object(l["a"])(e,[{key:"solve",value:function(e,t){return 0}},{key:"addEquation",value:function(e){e.enabled&&this.equations.push(e)}},{key:"removeEquation",value:function(e){var t=this.equations,i=t.indexOf(e);-1!==i&&t.splice(i,1)}},{key:"removeAllEquations",value:function(){this.equations.length=0}}]),e}(),lt=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(){var e;return Object(s["a"])(this,i),e=t.call(this),e.iterations=10,e.tolerance=1e-7,e}return Object(l["a"])(i,[{key:"solve",value:function(e,t){var i,n,o,a,r,s,l=0,u=this.iterations,h=this.tolerance*this.tolerance,c=this.equations,v=c.length,d=t.bodies,p=d.length,y=e;if(0!==v)for(var f=0;f!==p;f++)d[f].updateSolveMassProperties();var m=ht,b=ct,w=ut;m.length=v,b.length=v,w.length=v;for(var g=0;g!==v;g++){var x=c[g];w[g]=0,b[g]=x.computeB(y),m[g]=1/x.computeC()}if(0!==v){for(var E=0;E!==p;E++){var k=d[E],z=k.vlambda,S=k.wlambda;z.set(0,0,0),S.set(0,0,0)}for(l=0;l!==u;l++){a=0;for(var A=0;A!==v;A++){var j=c[A];i=b[A],n=m[A],s=w[A],r=j.computeGWlambda(),o=n*(i-r-j.eps*s),s+o<j.minForce?o=j.minForce-s:s+o>j.maxForce&&(o=j.maxForce-s),w[A]+=o,a+=o>0?o:-o,j.addToWlambda(o)}if(a*a<h)break}for(var O=0;O!==p;O++){var B=d[O],C=B.velocity,M=B.angularVelocity;B.vlambda.vmul(B.linearFactor,B.vlambda),C.vadd(B.vlambda,C),B.wlambda.vmul(B.angularFactor,B.wlambda),M.vadd(B.wlambda,M)}var N=c.length,P=1/y;while(N--)c[N].multiplier=w[N]*P}return l}}]),i}(st),ut=[],ht=[],ct=[];T.STATIC;var vt=function(){function e(){Object(s["a"])(this,e),this.objects=[],this.type=Object}return Object(l["a"])(e,[{key:"release",value:function(){for(var e=arguments.length,t=0;t!==e;t++)this.objects.push(t<0||arguments.length<=t?void 0:arguments[t]);return this}},{key:"get",value:function(){return 0===this.objects.length?this.constructObject():this.objects.pop()}},{key:"constructObject",value:function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{key:"resize",value:function(e){var t=this.objects;while(t.length>e)t.pop();while(t.length<e)t.push(this.constructObject());return this}}]),e}(),dt=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(){var e;return Object(s["a"])(this,i),e=t.call(this),e.type=h,e}return Object(l["a"])(i,[{key:"constructObject",value:function(){return new h}}]),i}(vt),pt={sphereSphere:k.types.SPHERE,spherePlane:k.types.SPHERE|k.types.PLANE,boxBox:k.types.BOX|k.types.BOX,sphereBox:k.types.SPHERE|k.types.BOX,planeBox:k.types.PLANE|k.types.BOX,convexConvex:k.types.CONVEXPOLYHEDRON,sphereConvex:k.types.SPHERE|k.types.CONVEXPOLYHEDRON,planeConvex:k.types.PLANE|k.types.CONVEXPOLYHEDRON,boxConvex:k.types.BOX|k.types.CONVEXPOLYHEDRON,sphereHeightfield:k.types.SPHERE|k.types.HEIGHTFIELD,boxHeightfield:k.types.BOX|k.types.HEIGHTFIELD,convexHeightfield:k.types.CONVEXPOLYHEDRON|k.types.HEIGHTFIELD,sphereParticle:k.types.PARTICLE|k.types.SPHERE,planeParticle:k.types.PLANE|k.types.PARTICLE,boxParticle:k.types.BOX|k.types.PARTICLE,convexParticle:k.types.PARTICLE|k.types.CONVEXPOLYHEDRON,cylinderCylinder:k.types.CYLINDER,sphereCylinder:k.types.SPHERE|k.types.CYLINDER,planeCylinder:k.types.PLANE|k.types.CYLINDER,boxCylinder:k.types.BOX|k.types.CYLINDER,convexCylinder:k.types.CONVEXPOLYHEDRON|k.types.CYLINDER,heightfieldCylinder:k.types.HEIGHTFIELD|k.types.CYLINDER,particleCylinder:k.types.PARTICLE|k.types.CYLINDER,sphereTrimesh:k.types.SPHERE|k.types.TRIMESH,planeTrimesh:k.types.PLANE|k.types.TRIMESH},yt=function(){function e(t){Object(s["a"])(this,e),this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new dt,this.world=t,this.currentContactMaterial=t.defaultContactMaterial,this.enableFrictionReduction=!1}return Object(l["a"])(e,[{key:"createContactEquation",value:function(e,t,i,n,o,a){var r;this.contactPointPool.length?(r=this.contactPointPool.pop(),r.bi=e,r.bj=t):r=new Ye(e,t),r.enabled=e.collisionResponse&&t.collisionResponse&&i.collisionResponse&&n.collisionResponse;var s=this.currentContactMaterial;r.restitution=s.restitution,r.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt);var l=i.material||e.material,u=n.material||t.material;return l&&u&&l.restitution>=0&&u.restitution>=0&&(r.restitution=l.restitution*u.restitution),r.si=o||i,r.sj=a||n,r}},{key:"createFrictionEquationsFromContact",value:function(e,t){var i=e.bi,n=e.bj,o=e.si,a=e.sj,r=this.world,s=this.currentContactMaterial,l=s.friction,u=o.material||i.material,h=a.material||n.material;if(u&&h&&u.friction>=0&&h.friction>=0&&(l=u.friction*h.friction),l>0){var c=l*r.gravity.length(),v=i.invMass+n.invMass;v>0&&(v=1/v);var d=this.frictionEquationPool,p=d.length?d.pop():new $e(i,n,c*v),y=d.length?d.pop():new $e(i,n,c*v);return p.bi=y.bi=i,p.bj=y.bj=n,p.minForce=y.minForce=-c*v,p.maxForce=y.maxForce=c*v,p.ri.copy(e.ri),p.rj.copy(e.rj),y.ri.copy(e.ri),y.rj.copy(e.rj),e.ni.tangents(p.t,y.t),p.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,r.dt),y.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,r.dt),p.enabled=y.enabled=e.enabled,t.push(p,y),!0}return!1}},{key:"createFrictionFromAverage",value:function(e){var t=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(t,this.frictionResult)&&1!==e){var i=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];ft.setZero(),mt.setZero(),bt.setZero();for(var o=t.bi,a=(t.bj,0);a!==e;a++)t=this.result[this.result.length-1-a],t.bi!==o?(ft.vadd(t.ni,ft),mt.vadd(t.ri,mt),bt.vadd(t.rj,bt)):(ft.vsub(t.ni,ft),mt.vadd(t.rj,mt),bt.vadd(t.ri,bt));var r=1/e;mt.scale(r,i.ri),bt.scale(r,i.rj),n.ri.copy(i.ri),n.rj.copy(i.rj),ft.normalize(),ft.tangents(i.t,n.t)}}},{key:"getContacts",value:function(e,t,i,n,o,a,r){this.contactPointPool=o,this.frictionEquationPool=r,this.result=n,this.frictionResult=a;for(var s=xt,l=Et,u=wt,h=gt,c=0,v=e.length;c!==v;c++){var d=e[c],p=t[c],y=null;d.material&&p.material&&(y=i.getContactMaterial(d.material,p.material)||null);for(var f=d.type&T.KINEMATIC&&p.type&T.STATIC||d.type&T.STATIC&&p.type&T.KINEMATIC||d.type&T.KINEMATIC&&p.type&T.KINEMATIC,m=0;m<d.shapes.length;m++){d.quaternion.mult(d.shapeOrientations[m],s),d.quaternion.vmult(d.shapeOffsets[m],u),u.vadd(d.position,u);for(var b=d.shapes[m],w=0;w<p.shapes.length;w++){p.quaternion.mult(p.shapeOrientations[w],l),p.quaternion.vmult(p.shapeOffsets[w],h),h.vadd(p.position,h);var g=p.shapes[w];if(b.collisionFilterMask&g.collisionFilterGroup&&g.collisionFilterMask&b.collisionFilterGroup&&!(u.distanceTo(h)>b.boundingSphereRadius+g.boundingSphereRadius)){var x=null;b.material&&g.material&&(x=i.getContactMaterial(b.material,g.material)||null),this.currentContactMaterial=x||y||i.defaultContactMaterial;var E=b.type|g.type,k=this[E];if(k){var z=!1;z=b.type<g.type?k.call(this,b,g,u,h,s,l,d,p,b,g,f):k.call(this,g,b,h,u,l,s,p,d,b,g,f),z&&f&&(i.shapeOverlapKeeper.set(b.id,g.id),i.bodyOverlapKeeper.set(d.id,p.id))}}}}}}},{key:"sphereSphere",value:function(e,t,i,n,o,a,r,s,l,u,h){if(h)return i.distanceSquared(n)<Math.pow(e.radius+t.radius,2);var c=this.createContactEquation(r,s,e,t,l,u);n.vsub(i,c.ni),c.ni.normalize(),c.ri.copy(c.ni),c.rj.copy(c.ni),c.ri.scale(e.radius,c.ri),c.rj.scale(-t.radius,c.rj),c.ri.vadd(i,c.ri),c.ri.vsub(r.position,c.ri),c.rj.vadd(n,c.rj),c.rj.vsub(s.position,c.rj),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}},{key:"spherePlane",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=this.createContactEquation(r,s,e,t,l,u);if(c.ni.set(0,0,1),a.vmult(c.ni,c.ni),c.ni.negate(c.ni),c.ni.normalize(),c.ni.scale(e.radius,c.ri),i.vsub(n,Wt),c.ni.scale(c.ni.dot(Wt),Ht),Wt.vsub(Ht,c.rj),-Wt.dot(c.ni)<=e.radius){if(h)return!0;var v=c.ri,d=c.rj;v.vadd(i,v),v.vsub(r.position,v),d.vadd(n,d),d.vsub(s.position,d),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}}},{key:"boxBox",value:function(e,t,i,n,o,a,r,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t.convexPolyhedronRepresentation,i,n,o,a,r,s,e,t,h)}},{key:"sphereBox",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=this.v3pool,v=Qt;i.vsub(n,Xt),t.getSideNormals(v,a);for(var d=e.radius,p=!1,y=$t,f=ei,m=ti,b=null,w=0,g=0,x=0,E=null,k=0,z=v.length;k!==z&&!1===p;k++){var S=Gt;S.copy(v[k]);var A=S.length();S.normalize();var j=Xt.dot(S);if(j<A+d&&j>0){var O=Zt,B=Kt;O.copy(v[(k+1)%3]),B.copy(v[(k+2)%3]);var C=O.length(),M=B.length();O.normalize(),B.normalize();var N=Xt.dot(O),P=Xt.dot(B);if(N<C&&N>-C&&P<M&&P>-M){var R=Math.abs(j-A-d);if((null===E||R<E)&&(E=R,g=N,x=P,b=A,y.copy(S),f.copy(O),m.copy(B),w++,h))return!0}}}if(w){p=!0;var T=this.createContactEquation(r,s,e,t,l,u);y.scale(-d,T.ri),T.ni.copy(y),T.ni.negate(T.ni),y.scale(b,y),f.scale(g,f),y.vadd(f,y),m.scale(x,m),y.vadd(m,T.rj),T.ri.vadd(i,T.ri),T.ri.vsub(r.position,T.ri),T.rj.vadd(n,T.rj),T.rj.vsub(s.position,T.rj),this.result.push(T),this.createFrictionEquationsFromContact(T,this.frictionResult)}for(var F=c.get(),L=Jt,q=0;2!==q&&!p;q++)for(var I=0;2!==I&&!p;I++)for(var D=0;2!==D&&!p;D++)if(F.set(0,0,0),q?F.vadd(v[0],F):F.vsub(v[0],F),I?F.vadd(v[1],F):F.vsub(v[1],F),D?F.vadd(v[2],F):F.vsub(v[2],F),n.vadd(F,L),L.vsub(i,L),L.lengthSquared()<d*d){if(h)return!0;p=!0;var W=this.createContactEquation(r,s,e,t,l,u);W.ri.copy(L),W.ri.normalize(),W.ni.copy(W.ri),W.ri.scale(d,W.ri),W.rj.copy(F),W.ri.vadd(i,W.ri),W.ri.vsub(r.position,W.ri),W.rj.vadd(n,W.rj),W.rj.vsub(s.position,W.rj),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}c.release(F),F=null;for(var H=c.get(),V=c.get(),Y=c.get(),_=c.get(),U=c.get(),X=v.length,G=0;G!==X&&!p;G++)for(var Z=0;Z!==X&&!p;Z++)if(G%3!==Z%3){v[Z].cross(v[G],H),H.normalize(),v[G].vadd(v[Z],V),Y.copy(i),Y.vsub(V,Y),Y.vsub(n,Y);var K=Y.dot(H);H.scale(K,_);var Q=0;while(Q===G%3||Q===Z%3)Q++;U.copy(i),U.vsub(_,U),U.vsub(V,U),U.vsub(n,U);var J=Math.abs(K),$=U.length();if(J<v[Q].length()&&$<d){if(h)return!0;p=!0;var ee=this.createContactEquation(r,s,e,t,l,u);V.vadd(_,ee.rj),ee.rj.copy(ee.rj),U.negate(ee.ni),ee.ni.normalize(),ee.ri.copy(ee.rj),ee.ri.vadd(n,ee.ri),ee.ri.vsub(i,ee.ri),ee.ri.normalize(),ee.ri.scale(d,ee.ri),ee.ri.vadd(i,ee.ri),ee.ri.vsub(r.position,ee.ri),ee.rj.vadd(n,ee.rj),ee.rj.vsub(s.position,ee.rj),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult)}}c.release(H,V,Y,_,U)}},{key:"planeBox",value:function(e,t,i,n,o,a,r,s,l,u,h){return t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,t.convexPolyhedronRepresentation.id=t.id,this.planeConvex(e,t.convexPolyhedronRepresentation,i,n,o,a,r,s,e,t,h)}},{key:"convexConvex",value:function(e,t,i,n,o,a,r,s,l,u,h,c,v){var d=fi;if(!(i.distanceTo(n)>e.boundingSphereRadius+t.boundingSphereRadius)&&e.findSeparatingAxis(t,i,o,n,a,d,c,v)){var p=[],y=mi;e.clipAgainstHull(i,o,t,n,a,d,-100,100,p);for(var f=0,m=0;m!==p.length;m++){if(h)return!0;var b=this.createContactEquation(r,s,e,t,l,u),w=b.ri,g=b.rj;d.negate(b.ni),p[m].normal.negate(y),y.scale(p[m].depth,y),p[m].point.vadd(y,w),g.copy(p[m].point),w.vsub(i,w),g.vsub(n,g),w.vadd(i,w),w.vsub(r.position,w),g.vadd(n,g),g.vsub(s.position,g),this.result.push(b),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(b,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)}}},{key:"sphereConvex",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=this.v3pool;i.vsub(n,ii);for(var v=t.faceNormals,d=t.faces,p=t.vertices,y=e.radius,f=!1,m=0;m!==p.length;m++){var b=p[m],w=ri;a.vmult(b,w),n.vadd(w,w);var g=ai;if(w.vsub(i,g),g.lengthSquared()<y*y){if(h)return!0;f=!0;var x=this.createContactEquation(r,s,e,t,l,u);return x.ri.copy(g),x.ri.normalize(),x.ni.copy(x.ri),x.ri.scale(y,x.ri),w.vsub(n,x.rj),x.ri.vadd(i,x.ri),x.ri.vsub(r.position,x.ri),x.rj.vadd(n,x.rj),x.rj.vsub(s.position,x.rj),this.result.push(x),void this.createFrictionEquationsFromContact(x,this.frictionResult)}}for(var E=0,k=d.length;E!==k&&!1===f;E++){var z=v[E],S=d[E],A=si;a.vmult(z,A);var j=li;a.vmult(p[S[0]],j),j.vadd(n,j);var O=ui;A.scale(-y,O),i.vadd(O,O);var B=hi;O.vsub(j,B);var C=B.dot(A),M=ci;if(i.vsub(j,M),C<0&&M.dot(A)>0){for(var N=[],P=0,R=S.length;P!==R;P++){var T=c.get();a.vmult(p[S[P]],T),n.vadd(T,T),N.push(T)}if(Ut(N,A,i)){if(h)return!0;f=!0;var F=this.createContactEquation(r,s,e,t,l,u);A.scale(-y,F.ri),A.negate(F.ni);var L=c.get();A.scale(-C,L);var q=c.get();A.scale(-y,q),i.vsub(n,F.rj),F.rj.vadd(q,F.rj),F.rj.vadd(L,F.rj),F.rj.vadd(n,F.rj),F.rj.vsub(s.position,F.rj),F.ri.vadd(i,F.ri),F.ri.vsub(r.position,F.ri),c.release(L),c.release(q),this.result.push(F),this.createFrictionEquationsFromContact(F,this.frictionResult);for(var I=0,D=N.length;I!==D;I++)c.release(N[I]);return}for(var W=0;W!==S.length;W++){var H=c.get(),V=c.get();a.vmult(p[S[(W+1)%S.length]],H),a.vmult(p[S[(W+2)%S.length]],V),n.vadd(H,H),n.vadd(V,V);var Y=ni;V.vsub(H,Y);var _=oi;Y.unit(_);var U=c.get(),X=c.get();i.vsub(H,X);var G=X.dot(_);_.scale(G,U),U.vadd(H,U);var Z=c.get();if(U.vsub(i,Z),G>0&&G*G<Y.lengthSquared()&&Z.lengthSquared()<y*y){if(h)return!0;var K=this.createContactEquation(r,s,e,t,l,u);U.vsub(n,K.rj),U.vsub(i,K.ni),K.ni.normalize(),K.ni.scale(y,K.ri),K.rj.vadd(n,K.rj),K.rj.vsub(s.position,K.rj),K.ri.vadd(i,K.ri),K.ri.vsub(r.position,K.ri),this.result.push(K),this.createFrictionEquationsFromContact(K,this.frictionResult);for(var Q=0,J=N.length;Q!==J;Q++)c.release(N[Q]);return c.release(H),c.release(V),c.release(U),c.release(Z),void c.release(X)}c.release(H),c.release(V),c.release(U),c.release(Z),c.release(X)}for(var $=0,ee=N.length;$!==ee;$++)c.release(N[$])}}}},{key:"planeConvex",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=vi,v=di;v.set(0,0,1),o.vmult(v,v);for(var d=0,p=pi,y=0;y!==t.vertices.length;y++){c.copy(t.vertices[y]),a.vmult(c,c),n.vadd(c,c),c.vsub(i,p);var f=v.dot(p);if(f<=0){if(h)return!0;var m=this.createContactEquation(r,s,e,t,l,u),b=yi;v.scale(v.dot(p),b),c.vsub(b,b),b.vsub(i,m.ri),m.ni.copy(v),c.vsub(n,m.rj),m.ri.vadd(i,m.ri),m.ri.vsub(r.position,m.ri),m.rj.vadd(n,m.rj),m.rj.vsub(s.position,m.rj),this.result.push(m),d++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(m,this.frictionResult)}}this.enableFrictionReduction&&d&&this.createFrictionFromAverage(d)}},{key:"boxConvex",value:function(e,t,i,n,o,a,r,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,t,i,n,o,a,r,s,e,t,h)}},{key:"sphereHeightfield",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=t.data,v=e.radius,d=t.elementSize,p=Mi,y=Ci;z.pointToLocalFrame(n,a,i,y);var f=Math.floor((y.x-v)/d)-1,m=Math.ceil((y.x+v)/d)+1,b=Math.floor((y.y-v)/d)-1,w=Math.ceil((y.y+v)/d)+1;if(!(m<0||w<0||f>c.length||b>c[0].length)){f<0&&(f=0),m<0&&(m=0),b<0&&(b=0),w<0&&(w=0),f>=c.length&&(f=c.length-1),m>=c.length&&(m=c.length-1),w>=c[0].length&&(w=c[0].length-1),b>=c[0].length&&(b=c[0].length-1);var g=[];t.getRectMinMax(f,b,m,w,g);var x=g[0],E=g[1];if(!(y.z-v>E||y.z+v<x))for(var k=this.result,S=f;S<m;S++)for(var A=b;A<w;A++){var j=k.length,O=!1;if(t.getConvexTrianglePillar(S,A,!1),z.pointToWorldFrame(n,a,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(O=this.sphereConvex(e,t.pillarConvex,i,p,o,a,r,s,e,t,h)),h&&O)return!0;if(t.getConvexTrianglePillar(S,A,!0),z.pointToWorldFrame(n,a,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(O=this.sphereConvex(e,t.pillarConvex,i,p,o,a,r,s,e,t,h)),h&&O)return!0;var B=k.length-j;if(B>2)return}}}},{key:"boxHeightfield",value:function(e,t,i,n,o,a,r,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,t,i,n,o,a,r,s,e,t,h)}},{key:"convexHeightfield",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=t.data,v=t.elementSize,d=e.boundingSphereRadius,p=Oi,y=Bi,f=ji;z.pointToLocalFrame(n,a,i,f);var m=Math.floor((f.x-d)/v)-1,b=Math.ceil((f.x+d)/v)+1,w=Math.floor((f.y-d)/v)-1,g=Math.ceil((f.y+d)/v)+1;if(!(b<0||g<0||m>c.length||w>c[0].length)){m<0&&(m=0),b<0&&(b=0),w<0&&(w=0),g<0&&(g=0),m>=c.length&&(m=c.length-1),b>=c.length&&(b=c.length-1),g>=c[0].length&&(g=c[0].length-1),w>=c[0].length&&(w=c[0].length-1);var x=[];t.getRectMinMax(m,w,b,g,x);var E=x[0],k=x[1];if(!(f.z-d>k||f.z+d<E))for(var S=m;S<b;S++)for(var A=w;A<g;A++){var j=!1;if(t.getConvexTrianglePillar(S,A,!1),z.pointToWorldFrame(n,a,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(j=this.convexConvex(e,t.pillarConvex,i,p,o,a,r,s,null,null,h,y,null)),h&&j)return!0;if(t.getConvexTrianglePillar(S,A,!0),z.pointToWorldFrame(n,a,t.pillarOffset,p),i.distanceTo(p)<t.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(j=this.convexConvex(e,t.pillarConvex,i,p,o,a,r,s,null,null,h,y,null)),h&&j)return!0}}}},{key:"sphereParticle",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=xi;c.set(0,0,1),n.vsub(i,c);var v=c.lengthSquared();if(v<=e.radius*e.radius){if(h)return!0;var d=this.createContactEquation(s,r,t,e,l,u);c.normalize(),d.rj.copy(c),d.rj.scale(e.radius,d.rj),d.ni.copy(c),d.ni.negate(d.ni),d.ri.set(0,0,0),this.result.push(d),this.createFrictionEquationsFromContact(d,this.frictionResult)}}},{key:"planeParticle",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=bi;c.set(0,0,1),r.quaternion.vmult(c,c);var v=wi;n.vsub(r.position,v);var d=c.dot(v);if(d<=0){if(h)return!0;var p=this.createContactEquation(s,r,t,e,l,u);p.ni.copy(c),p.ni.negate(p.ni),p.ri.set(0,0,0);var y=gi;c.scale(c.dot(n),y),n.vsub(y,y),p.rj.copy(y),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}}},{key:"boxParticle",value:function(e,t,i,n,o,a,r,s,l,u,h){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,t,i,n,o,a,r,s,e,t,h)}},{key:"convexParticle",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=-1,v=zi,d=Ai,p=null,y=ki;if(y.copy(n),y.vsub(i,y),o.conjugate(Ei),Ei.vmult(y,y),e.pointIsInside(y)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(i,o),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(o);for(var f=0,m=e.faces.length;f!==m;f++){var b=[e.worldVertices[e.faces[f][0]]],w=e.worldFaceNormals[f];n.vsub(b[0],Si);var g=-w.dot(Si);if(null===p||Math.abs(g)<Math.abs(p)){if(h)return!0;p=g,c=f,v.copy(w)}}if(-1!==c){var x=this.createContactEquation(s,r,t,e,l,u);v.scale(p,d),d.vadd(n,d),d.vsub(i,d),x.rj.copy(d),v.negate(x.ni),x.ri.set(0,0,0);var E=x.ri,k=x.rj;E.vadd(n,E),E.vsub(s.position,E),k.vadd(i,k),k.vsub(r.position,k),this.result.push(x),this.createFrictionEquationsFromContact(x,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}},{key:"heightfieldCylinder",value:function(e,t,i,n,o,a,r,s,l,u,h){return this.convexHeightfield(t,e,n,i,a,o,s,r,l,u,h)}},{key:"particleCylinder",value:function(e,t,i,n,o,a,r,s,l,u,h){return this.convexParticle(t,e,n,i,a,o,s,r,l,u,h)}},{key:"sphereTrimesh",value:function(e,t,i,n,o,a,r,s,l,u,h){var c=Ct,v=Mt,d=Nt,p=Pt,y=Rt,f=Tt,m=It,b=Bt,w=jt,g=Dt;z.pointToLocalFrame(n,a,i,y);var x=e.radius;m.lowerBound.set(y.x-x,y.y-x,y.z-x),m.upperBound.set(y.x+x,y.y+x,y.z+x),t.getTrianglesInAABB(m,g);for(var E=Ot,k=e.radius*e.radius,S=0;S<g.length;S++)for(var A=0;A<3;A++)if(t.getVertex(t.indices[3*g[S]+A],E),E.vsub(y,w),w.lengthSquared()<=k){if(b.copy(E),z.pointToWorldFrame(n,a,b,E),E.vsub(i,w),h)return!0;var j=this.createContactEquation(r,s,e,t,l,u);j.ni.copy(w),j.ni.normalize(),j.ri.copy(j.ni),j.ri.scale(e.radius,j.ri),j.ri.vadd(i,j.ri),j.ri.vsub(r.position,j.ri),j.rj.copy(E),j.rj.vsub(s.position,j.rj),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}for(var O=0;O<g.length;O++)for(var B=0;B<3;B++){t.getVertex(t.indices[3*g[O]+B],c),t.getVertex(t.indices[3*g[O]+(B+1)%3],v),v.vsub(c,d),y.vsub(v,f);var C=f.dot(d);y.vsub(c,f);var M=f.dot(d);if(M>0&&C<0){y.vsub(c,f),p.copy(d),p.normalize(),M=f.dot(p),p.scale(M,f),f.vadd(c,f);var N=f.distanceTo(y);if(N<e.radius){if(h)return!0;var P=this.createContactEquation(r,s,e,t,l,u);f.vsub(y,P.ni),P.ni.normalize(),P.ni.scale(e.radius,P.ri),P.ri.vadd(i,P.ri),P.ri.vsub(r.position,P.ri),z.pointToWorldFrame(n,a,f,f),f.vsub(s.position,P.rj),z.vectorToWorldFrame(a,P.ni,P.ni),z.vectorToWorldFrame(a,P.ri,P.ri),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult)}}}for(var R=Ft,T=Lt,F=qt,L=At,q=0,I=g.length;q!==I;q++){t.getTriangleVertices(g[q],R,T,F),t.getNormal(g[q],L),y.vsub(R,f);var D=f.dot(L);if(L.scale(D,f),y.vsub(f,f),D=f.distanceTo(y),ie.pointInTriangle(f,R,T,F)&&D<e.radius){if(h)return!0;var W=this.createContactEquation(r,s,e,t,l,u);f.vsub(y,W.ni),W.ni.normalize(),W.ni.scale(e.radius,W.ri),W.ri.vadd(i,W.ri),W.ri.vsub(r.position,W.ri),z.pointToWorldFrame(n,a,f,f),f.vsub(s.position,W.rj),z.vectorToWorldFrame(a,W.ni,W.ni),z.vectorToWorldFrame(a,W.ri,W.ri),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}}g.length=0}},{key:"planeTrimesh",value:function(e,t,i,n,o,a,r,s,l,u,c){var v=new h,d=kt;d.set(0,0,1),o.vmult(d,d);for(var p=0;p<t.vertices.length/3;p++){t.getVertex(p,v);var y=new h;y.copy(v),z.pointToWorldFrame(n,a,y,v);var f=zt;v.vsub(i,f);var m=d.dot(f);if(m<=0){if(c)return!0;var b=this.createContactEquation(r,s,e,t,l,u);b.ni.copy(d);var w=St;d.scale(f.dot(d),w),v.vsub(w,w),b.ri.copy(w),b.ri.vsub(r.position,b.ri),b.rj.copy(v),b.rj.vsub(s.position,b.rj),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult)}}}}]),e}(),ft=new h,mt=new h,bt=new h,wt=new h,gt=new h,xt=new w,Et=new w;yt.prototype[pt.boxBox]=yt.prototype.boxBox,yt.prototype[pt.boxConvex]=yt.prototype.boxConvex,yt.prototype[pt.boxParticle]=yt.prototype.boxParticle,yt.prototype[pt.sphereSphere]=yt.prototype.sphereSphere;var kt=new h,zt=new h,St=new h;yt.prototype[pt.planeTrimesh]=yt.prototype.planeTrimesh;var At=new h,jt=new h,Ot=new h,Bt=new h,Ct=new h,Mt=new h,Nt=new h,Pt=new h,Rt=new h,Tt=new h,Ft=new h,Lt=new h,qt=new h,It=new p,Dt=[];yt.prototype[pt.sphereTrimesh]=yt.prototype.sphereTrimesh;var Wt=new h,Ht=new h;yt.prototype[pt.spherePlane]=yt.prototype.spherePlane;var Vt=new h,Yt=new h,_t=new h;function Ut(e,t,i){for(var n=null,o=e.length,a=0;a!==o;a++){var r=e[a],s=Vt;e[(a+1)%o].vsub(r,s);var l=Yt;s.cross(t,l);var u=_t;i.vsub(r,u);var h=l.dot(u);if(!(null===n||h>0&&!0===n||h<=0&&!1===n))return!1;null===n&&(n=h>0)}return!0}var Xt=new h,Gt=new h,Zt=new h,Kt=new h,Qt=[new h,new h,new h,new h,new h,new h],Jt=new h,$t=new h,ei=new h,ti=new h;yt.prototype[pt.sphereBox]=yt.prototype.sphereBox;var ii=new h,ni=new h,oi=new h,ai=new h,ri=new h,si=new h,li=new h,ui=new h,hi=new h,ci=new h;yt.prototype[pt.sphereConvex]=yt.prototype.sphereConvex,yt.prototype[pt.planeBox]=yt.prototype.planeBox;var vi=new h,di=new h,pi=new h,yi=new h;yt.prototype[pt.planeConvex]=yt.prototype.planeConvex;var fi=new h,mi=new h;yt.prototype[pt.convexConvex]=yt.prototype.convexConvex;var bi=new h,wi=new h,gi=new h;yt.prototype[pt.planeParticle]=yt.prototype.planeParticle;var xi=new h;yt.prototype[pt.sphereParticle]=yt.prototype.sphereParticle,yt.prototype[pt.cylinderCylinder]=yt.prototype.convexConvex,yt.prototype[pt.sphereCylinder]=yt.prototype.sphereConvex,yt.prototype[pt.planeCylinder]=yt.prototype.planeConvex,yt.prototype[pt.boxCylinder]=yt.prototype.boxConvex,yt.prototype[pt.convexCylinder]=yt.prototype.convexConvex,yt.prototype[pt.heightfieldCylinder]=yt.prototype.heightfieldCylinder,yt.prototype[pt.particleCylinder]=yt.prototype.particleCylinder;var Ei=new w,ki=new h,zi=new h,Si=new h,Ai=new h;yt.prototype[pt.convexParticle]=yt.prototype.convexParticle,yt.prototype[pt.boxHeightfield]=yt.prototype.boxHeightfield;var ji=new h,Oi=new h,Bi=[0];yt.prototype[pt.convexHeightfield]=yt.prototype.convexHeightfield;var Ci=new h,Mi=new h;yt.prototype[pt.sphereHeightfield]=yt.prototype.sphereHeightfield;var Ni=function(){function e(){Object(s["a"])(this,e),this.current=[],this.previous=[]}return Object(l["a"])(e,[{key:"getKey",value:function(e,t){if(t<e){var i=t;t=e,e=i}return e<<16|t}},{key:"set",value:function(e,t){var i=this.getKey(e,t),n=this.current,o=0;while(i>n[o])o++;if(i!==n[o]){for(var a=n.length-1;a>=o;a--)n[a+1]=n[a];n[o]=i}}},{key:"tick",value:function(){var e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}},{key:"getDiff",value:function(e,t){for(var i=this.current,n=this.previous,o=i.length,a=n.length,r=0,s=0;s<o;s++){var l=!1,u=i[s];while(u>n[r])r++;l=u===n[r],l||Pi(e,u)}r=0;for(var h=0;h<a;h++){var c=!1,v=n[h];while(v>i[r])r++;c=i[r]===v,c||Pi(t,v)}}}]),e}();function Pi(e,t){e.push((4294901760&t)>>16,65535&t)}var Ri=function(){function e(){Object(s["a"])(this,e),this.data={keys:[]}}return Object(l["a"])(e,[{key:"get",value:function(e,t){if(e>t){var i=t;t=e,e=i}return this.data[e+"-"+t]}},{key:"set",value:function(e,t,i){if(e>t){var n=t;t=e,e=n}var o=e+"-"+t;this.get(e,t)||this.data.keys.push(o),this.data[o]=i}},{key:"reset",value:function(){var e=this.data,t=e.keys;while(t.length>0){var i=t.pop();delete e[i]}}}]),e}(),Ti=function(e){Object(a["a"])(i,e);var t=Object(r["a"])(i);function i(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s["a"])(this,i),e=t.call(this),e.dt=-1,e.allowSleep=!!o.allowSleep,e.contacts=[],e.frictionEquations=[],e.quatNormalizeSkip=void 0!==o.quatNormalizeSkip?o.quatNormalizeSkip:0,e.quatNormalizeFast=void 0!==o.quatNormalizeFast&&o.quatNormalizeFast,e.time=0,e.stepnumber=0,e.default_dt=1/60,e.nextId=0,e.gravity=new h,o.gravity&&e.gravity.copy(o.gravity),e.broadphase=void 0!==o.broadphase?o.broadphase:new ee,e.bodies=[],e.hasActiveBodies=!1,e.solver=void 0!==o.solver?o.solver:new lt,e.constraints=[],e.narrowphase=new yt(Object(n["a"])(e)),e.collisionMatrix=new m,e.collisionMatrixPrevious=new m,e.bodyOverlapKeeper=new Ni,e.shapeOverlapKeeper=new Ni,e.materials=[],e.contactmaterials=[],e.contactMaterialTable=new Ri,e.defaultMaterial=new nt("default"),e.defaultContactMaterial=new it(e.defaultMaterial,e.defaultMaterial,{friction:.3,restitution:0}),e.doProfiling=!1,e.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},e.accumulator=0,e.subsystems=[],e.addBodyEvent={type:"addBody",body:null},e.removeBodyEvent={type:"removeBody",body:null},e.idToBodyMap={},e.broadphase.setWorld(Object(n["a"])(e)),e}return Object(l["a"])(i,[{key:"getContactMaterial",value:function(e,t){return this.contactMaterialTable.get(e.id,t.id)}},{key:"numObjects",value:function(){return this.bodies.length}},{key:"collisionMatrixTick",value:function(){var e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}},{key:"addConstraint",value:function(e){this.constraints.push(e)}},{key:"removeConstraint",value:function(e){var t=this.constraints.indexOf(e);-1!==t&&this.constraints.splice(t,1)}},{key:"rayTest",value:function(e,t,i){i instanceof te?this.raycastClosest(e,t,{skipBackfaces:!0},i):this.raycastAll(e,t,{skipBackfaces:!0},i)}},{key:"raycastAll",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return i.mode=ie.ALL,i.from=e,i.to=t,i.callback=n,Fi.intersectWorld(this,i)}},{key:"raycastAny",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return i.mode=ie.ANY,i.from=e,i.to=t,i.result=n,Fi.intersectWorld(this,i)}},{key:"raycastClosest",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0;return i.mode=ie.CLOSEST,i.from=e,i.to=t,i.result=n,Fi.intersectWorld(this,i)}},{key:"addBody",value:function(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof T&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}},{key:"removeBody",value:function(e){e.world=null;var t=this.bodies.length-1,i=this.bodies,n=i.indexOf(e);if(-1!==n){i.splice(n,1);for(var o=0;o!==i.length;o++)i[o].index=o;this.collisionMatrix.setNumObjects(t),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}},{key:"getBodyById",value:function(e){return this.idToBodyMap[e]}},{key:"getShapeById",value:function(e){for(var t=this.bodies,i=0,n=t.length;i<n;i++)for(var o=t[i].shapes,a=0,r=o.length;a<r;a++){var s=o[a];if(s.id===e)return s}}},{key:"addMaterial",value:function(e){this.materials.push(e)}},{key:"addContactMaterial",value:function(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}},{key:"step",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(void 0===t)this.internalStep(e),this.time+=e;else{this.accumulator+=t;var n=Li.now(),o=0;while(this.accumulator>=e&&o<i)if(this.internalStep(e),this.accumulator-=e,o++,Li.now()-n>1e3*e)break;this.accumulator=this.accumulator%e;for(var a=this.accumulator/e,r=0;r!==this.bodies.length;r++){var s=this.bodies[r];s.previousPosition.lerp(s.position,a,s.interpolatedPosition),s.previousQuaternion.slerp(s.quaternion,a,s.interpolatedQuaternion),s.previousQuaternion.normalize()}this.time+=t}}},{key:"internalStep",value:function(e){this.dt=e;var t=this.contacts,i=Yi,n=_i,o=this.numObjects(),a=this.bodies,r=this.solver,s=this.gravity,l=this.doProfiling,u=this.profile,h=T.DYNAMIC,c=-1/0,v=this.constraints,d=Vi,p=(s.length(),s.x),y=s.y,f=s.z,m=0;for(l&&(c=Li.now()),m=0;m!==o;m++){var b=a[m];if(b.type===h){var w=b.force,g=b.mass;w.x+=g*p,w.y+=g*y,w.z+=g*f}}for(var x=0,E=this.subsystems.length;x!==E;x++)this.subsystems[x].update();l&&(c=Li.now()),i.length=0,n.length=0,this.broadphase.collisionPairs(this,i,n),l&&(u.broadphase=Li.now()-c);var k=v.length;for(m=0;m!==k;m++){var z=v[m];if(!z.collideConnected)for(var S=i.length-1;S>=0;S-=1)(z.bodyA===i[S]&&z.bodyB===n[S]||z.bodyB===i[S]&&z.bodyA===n[S])&&(i.splice(S,1),n.splice(S,1))}this.collisionMatrixTick(),l&&(c=Li.now());var A=Hi,j=t.length;for(m=0;m!==j;m++)A.push(t[m]);t.length=0;var O=this.frictionEquations.length;for(m=0;m!==O;m++)d.push(this.frictionEquations[m]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,n,this,t,A,this.frictionEquations,d),l&&(u.narrowphase=Li.now()-c),l&&(c=Li.now()),m=0;m<this.frictionEquations.length;m++)r.addEquation(this.frictionEquations[m]);for(var B=t.length,C=0;C!==B;C++){var M=t[C],N=M.bi,P=M.bj,R=M.si,F=M.sj,L=void 0;L=N.material&&P.material&&this.getContactMaterial(N.material,P.material)||this.defaultContactMaterial;L.friction;if(N.material&&P.material&&(N.material.friction>=0&&P.material.friction>=0&&N.material.friction*P.material.friction,N.material.restitution>=0&&P.material.restitution>=0&&(M.restitution=N.material.restitution*P.material.restitution)),r.addEquation(M),N.allowSleep&&N.type===T.DYNAMIC&&N.sleepState===T.SLEEPING&&P.sleepState===T.AWAKE&&P.type!==T.STATIC){var q=P.velocity.lengthSquared()+P.angularVelocity.lengthSquared(),I=Math.pow(P.sleepSpeedLimit,2);q>=2*I&&(N.wakeUpAfterNarrowphase=!0)}if(P.allowSleep&&P.type===T.DYNAMIC&&P.sleepState===T.SLEEPING&&N.sleepState===T.AWAKE&&N.type!==T.STATIC){var D=N.velocity.lengthSquared()+N.angularVelocity.lengthSquared(),W=Math.pow(N.sleepSpeedLimit,2);D>=2*W&&(P.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(N,P,!0),this.collisionMatrixPrevious.get(N,P)||(Wi.body=P,Wi.contact=M,N.dispatchEvent(Wi),Wi.body=N,P.dispatchEvent(Wi)),this.bodyOverlapKeeper.set(N.id,P.id),this.shapeOverlapKeeper.set(R.id,F.id)}for(this.emitContactEvents(),l&&(u.makeContactConstraints=Li.now()-c,c=Li.now()),m=0;m!==o;m++){var H=a[m];H.wakeUpAfterNarrowphase&&(H.wakeUp(),H.wakeUpAfterNarrowphase=!1)}for(k=v.length,m=0;m!==k;m++){var V=v[m];V.update();for(var Y=0,_=V.equations.length;Y!==_;Y++){var U=V.equations[Y];r.addEquation(U)}}r.solve(e,this),l&&(u.solve=Li.now()-c),r.removeAllEquations();var X=Math.pow;for(m=0;m!==o;m++){var G=a[m];if(G.type&h){var Z=X(1-G.linearDamping,e),K=G.velocity;K.scale(Z,K);var Q=G.angularVelocity;if(Q){var J=X(1-G.angularDamping,e);Q.scale(J,Q)}}}for(this.dispatchEvent(Di),m=0;m!==o;m++){var $=a[m];$.preStep&&$.preStep.call($)}l&&(c=Li.now());var ee=this.stepnumber,te=ee%(this.quatNormalizeSkip+1)===0,ie=this.quatNormalizeFast;for(m=0;m!==o;m++)a[m].integrate(e,te,ie);for(this.clearForces(),this.broadphase.dirty=!0,l&&(u.integrate=Li.now()-c),this.time+=e,this.stepnumber+=1,this.dispatchEvent(Ii),m=0;m!==o;m++){var ne=a[m],oe=ne.postStep;oe&&oe.call(ne)}var ae=!0;if(this.allowSleep)for(ae=!1,m=0;m!==o;m++){var re=a[m];re.sleepTick(this.time),re.sleepState!==T.SLEEPING&&(ae=!0)}this.hasActiveBodies=ae}},{key:"clearForces",value:function(){for(var e=this.bodies,t=e.length,i=0;i!==t;i++){var n=e[i];n.force,n.torque;n.force.set(0,0,0),n.torque.set(0,0,0)}}}]),i}(b),Fi=(new p,new ie),Li=globalThis.performance||{};if(!Li.now){var qi=Date.now();Li.timing&&Li.timing.navigationStart&&(qi=Li.timing.navigationStart),Li.now=function(){return Date.now()-qi}}var Ii={type:"postStep"},Di={type:"preStep"},Wi={type:T.COLLIDE_EVENT_NAME,body:null,contact:null},Hi=[],Vi=[],Yi=[],_i=[];Ti.prototype.emitContactEvents=function(){var e=[],t=[],i={type:"beginContact",bodyA:null,bodyB:null},n={type:"endContact",bodyA:null,bodyB:null},o={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},a={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};return function(){var r=this.hasAnyEventListener("beginContact"),s=this.hasAnyEventListener("endContact");if((r||s)&&this.bodyOverlapKeeper.getDiff(e,t),r){for(var l=0,u=e.length;l<u;l+=2)i.bodyA=this.getBodyById(e[l]),i.bodyB=this.getBodyById(e[l+1]),this.dispatchEvent(i);i.bodyA=i.bodyB=null}if(s){for(var h=0,c=t.length;h<c;h+=2)n.bodyA=this.getBodyById(t[h]),n.bodyB=this.getBodyById(t[h+1]),this.dispatchEvent(n);n.bodyA=n.bodyB=null}e.length=t.length=0;var v=this.hasAnyEventListener("beginShapeContact"),d=this.hasAnyEventListener("endShapeContact");if((v||d)&&this.shapeOverlapKeeper.getDiff(e,t),v){for(var p=0,y=e.length;p<y;p+=2){var f=this.getShapeById(e[p]),m=this.getShapeById(e[p+1]);o.shapeA=f,o.shapeB=m,o.bodyA=f.body,o.bodyB=m.body,this.dispatchEvent(o)}o.bodyA=o.bodyB=o.shapeA=o.shapeB=null}if(d){for(var b=0,w=t.length;b<w;b+=2){var g=this.getShapeById(t[b]),x=this.getShapeById(t[b+1]);a.shapeA=g,a.shapeB=x,a.bodyA=g.body,a.bodyB=x.body,this.dispatchEvent(a)}a.bodyA=a.bodyB=a.shapeA=a.shapeB=null}}}()},2532:function(e,t,i){"use strict";var n=i("23e7"),o=i("5a34"),a=i("1d80"),r=i("ab13");n({target:"String",proto:!0,forced:!r("includes")},{includes:function(e){return!!~String(a(this)).indexOf(o(e),arguments.length>1?arguments[1]:void 0)}})},3191:function(e,t,i){(function(t,i){e.exports=i()})(0,(function(){var e=function(){function t(e){return o.appendChild(e.dom),e}function i(e){for(var t=0;t<o.children.length;t++)o.children[t].style.display=t===e?"block":"none";n=e}var n=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",(function(e){e.preventDefault(),i(++n%o.children.length)}),!1);var a=(performance||Date).now(),r=a,s=0,l=t(new e.Panel("FPS","#0ff","#002")),u=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:t,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(u.update(e-a,200),e>r+1e3&&(l.update(1e3*s/(e-r),100),r=e,s=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:o,setMode:i}};return e.Panel=function(e,t,i){var n=1/0,o=0,a=Math.round,r=a(window.devicePixelRatio||1),s=80*r,l=48*r,u=3*r,h=2*r,c=3*r,v=15*r,d=74*r,p=30*r,y=document.createElement("canvas");y.width=s,y.height=l,y.style.cssText="width:80px;height:48px";var f=y.getContext("2d");return f.font="bold "+9*r+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=i,f.fillRect(0,0,s,l),f.fillStyle=t,f.fillText(e,u,h),f.fillRect(c,v,d,p),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(c,v,d,p),{dom:y,update:function(l,m){n=Math.min(n,l),o=Math.max(o,l),f.fillStyle=i,f.globalAlpha=1,f.fillRect(0,0,s,v),f.fillStyle=t,f.fillText(a(l)+" "+e+" ("+a(n)+"-"+a(o)+")",u,h),f.drawImage(y,c+r,v,d-r,p,c,v,d-r,p),f.fillRect(c+d-r,v,r,p),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(c+d-r,v,r,a((1-l/m)*p))}}},e}))},4478:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));i("4ae1");var n=i("b380"),o=i("d967");function a(e,t,i){return a=Object(o["a"])()?Reflect.construct:function(e,t,i){var o=[null];o.push.apply(o,t);var a=Function.bind.apply(e,o),r=new a;return i&&Object(n["a"])(r,i.prototype),r},a.apply(null,arguments)}},4721:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));i("d3b7"),i("ddb0"),i("4c53");var n=i("5a89"),o=function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new n["Cb"],this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:n["N"].ROTATE,MIDDLE:n["N"].DOLLY,RIGHT:n["N"].PAN},this.touches={ONE:n["wb"].ROTATE,TWO:n["wb"].DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return h.phi},this.getAzimuthalAngle=function(){return h.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",re),this._domElementKeyEvents=e},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(o),i.update(),l=s.NONE},this.update=function(){var t=new n["Cb"],a=(new n["jb"]).setFromUnitVectors(e.up,new n["Cb"](0,1,0)),r=a.clone().invert(),y=new n["Cb"],f=new n["jb"],m=2*Math.PI;return function(){var e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(a),h.setFromVector3(t),i.autoRotate&&l===s.NONE&&A(z()),i.enableDamping?(h.theta+=c.theta*i.dampingFactor,h.phi+=c.phi*i.dampingFactor):(h.theta+=c.theta,h.phi+=c.phi);var n=i.minAzimuthAngle,b=i.maxAzimuthAngle;return isFinite(n)&&isFinite(b)&&(n<-Math.PI?n+=m:n>Math.PI&&(n-=m),b<-Math.PI?b+=m:b>Math.PI&&(b-=m),h.theta=n<=b?Math.max(n,Math.min(b,h.theta)):h.theta>(n+b)/2?Math.max(n,h.theta):Math.min(b,h.theta)),h.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,h.phi)),h.makeSafe(),h.radius*=v,h.radius=Math.max(i.minDistance,Math.min(i.maxDistance,h.radius)),!0===i.enableDamping?i.target.addScaledVector(d,i.dampingFactor):i.target.add(d),t.setFromSpherical(h),t.applyQuaternion(r),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(c.theta*=1-i.dampingFactor,c.phi*=1-i.dampingFactor,d.multiplyScalar(1-i.dampingFactor)):(c.set(0,0,0),d.set(0,0,0)),v=1,!!(p||y.distanceToSquared(i.object.position)>u||8*(1-f.dot(i.object.quaternion))>u)&&(i.dispatchEvent(o),y.copy(i.object.position),f.copy(i.object.quaternion),p=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",he),i.domElement.removeEventListener("pointerdown",$),i.domElement.removeEventListener("wheel",ae),i.domElement.removeEventListener("touchstart",se),i.domElement.removeEventListener("touchend",ue),i.domElement.removeEventListener("touchmove",le),i.domElement.ownerDocument.removeEventListener("pointermove",ee),i.domElement.ownerDocument.removeEventListener("pointerup",te),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",re)};var i=this,o={type:"change"},a={type:"start"},r={type:"end"},s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=s.NONE,u=1e-6,h=new n["ub"],c=new n["ub"],v=1,d=new n["Cb"],p=!1,y=new n["Bb"],f=new n["Bb"],m=new n["Bb"],b=new n["Bb"],w=new n["Bb"],g=new n["Bb"],x=new n["Bb"],E=new n["Bb"],k=new n["Bb"];function z(){return 2*Math.PI/60/60*i.autoRotateSpeed}function S(){return Math.pow(.95,i.zoomSpeed)}function A(e){c.theta-=e}function j(e){c.phi-=e}var O=function(){var e=new n["Cb"];return function(t,i){e.setFromMatrixColumn(i,0),e.multiplyScalar(-t),d.add(e)}}(),B=function(){var e=new n["Cb"];return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),d.add(e)}}(),C=function(){var e=new n["Cb"];return function(t,n){var o=i.domElement;if(i.object.isPerspectiveCamera){var a=i.object.position;e.copy(a).sub(i.target);var r=e.length();r*=Math.tan(i.object.fov/2*Math.PI/180),O(2*t*r/o.clientHeight,i.object.matrix),B(2*n*r/o.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(O(t*(i.object.right-i.object.left)/i.object.zoom/o.clientWidth,i.object.matrix),B(n*(i.object.top-i.object.bottom)/i.object.zoom/o.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function M(e){i.object.isPerspectiveCamera?v/=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function N(e){i.object.isPerspectiveCamera?v*=e:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function P(e){y.set(e.clientX,e.clientY)}function R(e){x.set(e.clientX,e.clientY)}function T(e){b.set(e.clientX,e.clientY)}function F(e){f.set(e.clientX,e.clientY),m.subVectors(f,y).multiplyScalar(i.rotateSpeed);var t=i.domElement;A(2*Math.PI*m.x/t.clientHeight),j(2*Math.PI*m.y/t.clientHeight),y.copy(f),i.update()}function L(e){E.set(e.clientX,e.clientY),k.subVectors(E,x),k.y>0?M(S()):k.y<0&&N(S()),x.copy(E),i.update()}function q(e){w.set(e.clientX,e.clientY),g.subVectors(w,b).multiplyScalar(i.panSpeed),C(g.x,g.y),b.copy(w),i.update()}function I(){}function D(e){e.deltaY<0?N(S()):e.deltaY>0&&M(S()),i.update()}function W(e){var t=!1;switch(e.code){case i.keys.UP:C(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:C(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:C(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:C(-i.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),i.update())}function H(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,i)}}function V(e){if(1==e.touches.length)b.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),i=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(t,i)}}function Y(e){var t=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(t*t+i*i);x.set(0,n)}function _(e){i.enableZoom&&Y(e),i.enablePan&&V(e)}function U(e){i.enableZoom&&Y(e),i.enableRotate&&H(e)}function X(e){if(1==e.touches.length)f.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);f.set(t,n)}m.subVectors(f,y).multiplyScalar(i.rotateSpeed);var o=i.domElement;A(2*Math.PI*m.x/o.clientHeight),j(2*Math.PI*m.y/o.clientHeight),y.copy(f)}function G(e){if(1==e.touches.length)w.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);w.set(t,n)}g.subVectors(w,b).multiplyScalar(i.panSpeed),C(g.x,g.y),b.copy(w)}function Z(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);E.set(0,o),k.set(0,Math.pow(E.y/x.y,i.zoomSpeed)),M(k.y),x.copy(E)}function K(e){i.enableZoom&&Z(e),i.enablePan&&G(e)}function Q(e){i.enableZoom&&Z(e),i.enableRotate&&X(e)}function J(){}function $(e){if(!1!==i.enabled)switch(e.pointerType){case"mouse":case"pen":ie(e);break}}function ee(e){if(!1!==i.enabled)switch(e.pointerType){case"mouse":case"pen":ne(e);break}}function te(e){switch(e.pointerType){case"mouse":case"pen":oe(e);break}}function ie(e){var t;switch(e.preventDefault(),i.domElement.focus?i.domElement.focus():window.focus(),e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n["N"].DOLLY:if(!1===i.enableZoom)return;R(e),l=s.DOLLY;break;case n["N"].ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;T(e),l=s.PAN}else{if(!1===i.enableRotate)return;P(e),l=s.ROTATE}break;case n["N"].PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;P(e),l=s.ROTATE}else{if(!1===i.enablePan)return;T(e),l=s.PAN}break;default:l=s.NONE}l!==s.NONE&&(i.domElement.ownerDocument.addEventListener("pointermove",ee),i.domElement.ownerDocument.addEventListener("pointerup",te),i.dispatchEvent(a))}function ne(e){if(!1!==i.enabled)switch(e.preventDefault(),l){case s.ROTATE:if(!1===i.enableRotate)return;F(e);break;case s.DOLLY:if(!1===i.enableZoom)return;L(e);break;case s.PAN:if(!1===i.enablePan)return;q(e);break}}function oe(e){i.domElement.ownerDocument.removeEventListener("pointermove",ee),i.domElement.ownerDocument.removeEventListener("pointerup",te),!1!==i.enabled&&(I(e),i.dispatchEvent(r),l=s.NONE)}function ae(e){!1===i.enabled||!1===i.enableZoom||l!==s.NONE&&l!==s.ROTATE||(e.preventDefault(),i.dispatchEvent(a),D(e),i.dispatchEvent(r))}function re(e){!1!==i.enabled&&!1!==i.enablePan&&W(e)}function se(e){if(!1!==i.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(i.touches.ONE){case n["wb"].ROTATE:if(!1===i.enableRotate)return;H(e),l=s.TOUCH_ROTATE;break;case n["wb"].PAN:if(!1===i.enablePan)return;V(e),l=s.TOUCH_PAN;break;default:l=s.NONE}break;case 2:switch(i.touches.TWO){case n["wb"].DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;_(e),l=s.TOUCH_DOLLY_PAN;break;case n["wb"].DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;U(e),l=s.TOUCH_DOLLY_ROTATE;break;default:l=s.NONE}break;default:l=s.NONE}l!==s.NONE&&i.dispatchEvent(a)}}function le(e){if(!1!==i.enabled)switch(e.preventDefault(),l){case s.TOUCH_ROTATE:if(!1===i.enableRotate)return;X(e),i.update();break;case s.TOUCH_PAN:if(!1===i.enablePan)return;G(e),i.update();break;case s.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;K(e),i.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;Q(e),i.update();break;default:l=s.NONE}}function ue(e){!1!==i.enabled&&(J(e),i.dispatchEvent(r),l=s.NONE)}function he(e){!1!==i.enabled&&e.preventDefault()}i.domElement.addEventListener("contextmenu",he),i.domElement.addEventListener("pointerdown",$),i.domElement.addEventListener("wheel",ae),i.domElement.addEventListener("touchstart",se),i.domElement.addEventListener("touchend",ue),i.domElement.addEventListener("touchmove",le),this.update()};o.prototype=Object.create(n["s"].prototype),o.prototype.constructor=o;var a=function(e,t){o.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=n["N"].PAN,this.mouseButtons.RIGHT=n["N"].ROTATE,this.touches.ONE=n["wb"].PAN,this.touches.TWO=n["wb"].DOLLY_ROTATE};a.prototype=Object.create(n["s"].prototype),a.prototype.constructor=a},"4b1d":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var n=i("5a89");function o(){var e=new n["ob"],t=new n["j"];t.deleteAttribute("uv");var i=new n["U"]({side:n["g"]}),o=new n["U"],a=new n["fb"](16777215,5,28,2);a.position.set(.418,16.199,.3),e.add(a);var r=new n["R"](t,i);r.position.set(-.757,13.219,.717),r.scale.set(31.713,28.305,28.591),e.add(r);var s=new n["R"](t,o);s.position.set(-10.906,2.009,1.846),s.rotation.set(0,-.195,0),s.scale.set(2.328,7.905,4.651),e.add(s);var l=new n["R"](t,o);l.position.set(-5.607,-.754,-.758),l.rotation.set(0,.994,0),l.scale.set(1.97,1.534,3.955),e.add(l);var u=new n["R"](t,o);u.position.set(6.167,.857,7.803),u.rotation.set(0,.561,0),u.scale.set(3.927,6.285,3.687),e.add(u);var h=new n["R"](t,o);h.position.set(-2.017,.018,6.124),h.rotation.set(0,.333,0),h.scale.set(2.002,4.566,2.064),e.add(h);var c=new n["R"](t,o);c.position.set(2.291,-.756,-2.621),c.rotation.set(0,-.286,0),c.scale.set(1.546,1.552,1.496),e.add(c);var v=new n["R"](t,o);v.position.set(-2.193,-.369,-5.547),v.rotation.set(0,.516,0),v.scale.set(3.875,3.487,2.986),e.add(v);var d=new n["R"](t,w(50));d.position.set(-16.116,14.37,8.208),d.scale.set(.1,2.428,2.739),e.add(d);var p=new n["R"](t,w(50));p.position.set(-16.109,18.021,-8.207),p.scale.set(.1,2.425,2.751),e.add(p);var y=new n["R"](t,w(17));y.position.set(14.904,12.198,-1.832),y.scale.set(.15,4.265,6.331),e.add(y);var f=new n["R"](t,w(43));f.position.set(-.462,8.89,14.52),f.scale.set(4.38,5.441,.088),e.add(f);var m=new n["R"](t,w(20));m.position.set(3.235,11.486,-12.541),m.scale.set(2.5,2,.1),e.add(m);var b=new n["R"](t,w(100));function w(e){var t=new n["S"];return t.color.setScalar(e),t}return b.position.set(0,20,0),b.scale.set(1,.1,1),e.add(b),e}},"5a34":function(e,t,i){var n=i("44e7");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},"6c57":function(e,t,i){var n=i("23e7"),o=i("da84");n({global:!0},{globalThis:o})},ab13:function(e,t,i){var n=i("b622"),o=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[o]=!1,"/./"[e](t)}catch(n){}}return!1}}}]);
//# sourceMappingURL=webgl~253ae210.2b881dfd.js.map